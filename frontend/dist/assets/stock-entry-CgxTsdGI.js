import{D as i,E as q,j as e,C as $,o as n,T as s,S as P,e as y,f,q as Q,H as p,B as C,G as U,v as L,J as X,K as Y,M as J,N as Z,O as ee,Q as re,R as te,U as se,V as ae,W as ne,X as oe,b as le,Y as ie,h as ce,c as de,Z as B}from"./index-CxzheAlx.js";import{V as F}from"./v-stack-Clf1x48u.js";import{H as he}from"./index-D7ZSCJA-.js";import{B as k}from"./badge-DapnaDzq.js";import{G as H}from"./grid-CH0aUrGp.js";import{S as ge}from"./separator-DILM_yuv.js";function ue(r){const{each:u,fallback:o,children:S}=r;return u?.length===0?o||null:u?.map(S)}function M({value:r,onChange:u,children:o,...S}){return e.jsx("select",{value:r,onChange:c=>u(c.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)",fontSize:"14px",cursor:"pointer",...S.style},onFocus:c=>{c.currentTarget.style.borderColor="var(--chakra-colors-teal-500)",c.currentTarget.style.boxShadow="0 0 0 1px var(--chakra-colors-teal-500)"},onBlur:c=>{c.currentTarget.style.borderColor="var(--chakra-colors-input-border)",c.currentTarget.style.boxShadow="none"},...S,children:o})}function G(r){return r.current_stock===0?"red":r.reorder_level&&r.current_stock!==void 0&&r.current_stock<=r.reorder_level?"orange":"green"}function xe(r){return r.current_stock===0?"Out of Stock":r.reorder_level&&r.current_stock!==void 0&&r.current_stock<=r.reorder_level?"Low Stock":"In Stock"}function me({selectedProduct:r,onClose:u}){const o=oe(),{showSuccessToast:S}=de(),[c,D]=i.useState(r?.current_stock||0),[T,W]=i.useState(0),[a,x]=i.useState(0),[m,A]=i.useState(null),[j,E]=i.useState("");i.useEffect(()=>{r&&(D(r.current_stock||0),W(0),x(0),A(null),E(""))},[r]);const d=c+T,_=d-a,g=m!==null?m-_:null,z=le({mutationFn:l=>ie.createStockEntry({requestBody:l}),onSuccess:()=>{S("Stock entry created successfully."),o.invalidateQueries({queryKey:["stock-entries"]}),o.invalidateQueries({queryKey:["products"]}),u()},onError:l=>{ce(l)}}),N=()=>{if(!r)return;const l={product_id:r.id,opening_stock:c,added_stock:T,total_stock:d,sales:a,closing_stock:_,physical_count:m||void 0,variance:g||void 0,amount:a*parseFloat(r.selling_price),notes:j||void 0,entry_date:new Date().toISOString()};z.mutate(l)};return r?e.jsxs(F,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(s,{fontSize:"md",fontWeight:"semibold",mb:3,children:"Product Details"}),e.jsxs(F,{align:"stretch",gap:2,p:4,borderWidth:"1px",borderRadius:"md",bg:{base:"gray.900",_light:"gray.50"},borderColor:{base:"gray.700",_light:"gray.200"},children:[e.jsxs(p,{justify:"space-between",children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Product"}),e.jsx(s,{fontWeight:"semibold",children:r.name})]}),e.jsxs(p,{justify:"space-between",children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Category"}),e.jsx(k,{colorScheme:"blue",size:"sm",children:r.category.name})]}),e.jsxs(p,{justify:"space-between",children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Status"}),e.jsx(k,{colorScheme:"purple",size:"sm",children:r.status.name})]}),e.jsxs(p,{justify:"space-between",children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Selling Price"}),e.jsxs(s,{fontWeight:"bold",color:"teal.400",children:["KES"," ",parseFloat(r.selling_price).toLocaleString()]})]}),e.jsxs(p,{justify:"space-between",children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Current Stock"}),e.jsxs(k,{colorScheme:G(r),size:"sm",children:[r.current_stock," units"]})]})]})]}),e.jsx(ge,{}),e.jsxs(n,{children:[e.jsx(s,{fontSize:"md",fontWeight:"semibold",mb:3,children:"Stock Entry"}),e.jsxs(F,{gap:4,align:"stretch",children:[e.jsx(y,{label:"Opening Stock",helperText:"Stock at start of day",children:e.jsx(f,{type:"number",value:c,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(y,{label:"Added Stock",helperText:"New deliveries/restocking",children:e.jsx(f,{type:"number",value:T,onChange:l=>W(Number(l.target.value)),min:0})}),e.jsx(y,{label:"Total Available",helperText:"Auto-calculated",children:e.jsx(f,{type:"number",value:d,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(y,{label:"Sales",helperText:"Units sold during shift",children:e.jsx(f,{type:"number",value:a,onChange:l=>x(Number(l.target.value)),min:0,max:d})}),e.jsx(y,{label:"Closing Stock",helperText:"Auto-calculated",children:e.jsx(f,{type:"number",value:_,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(y,{label:"Physical Count",helperText:"Manual count (optional)",children:e.jsx(f,{type:"number",value:m??"",onChange:l=>A(l.target.value?Number(l.target.value):null),min:0,placeholder:"Enter physical count"})}),g!==null&&g!==0&&e.jsxs(n,{p:3,borderRadius:"md",bg:g<0?"red.900":"orange.900",borderWidth:"1px",borderColor:g<0?"red.500":"orange.500",children:[e.jsxs(s,{fontWeight:"bold",color:g<0?"red.300":"orange.300",fontSize:"sm",children:["⚠️ Variance: ",g>0?"+":"",g," units"]}),e.jsx(s,{fontSize:"xs",color:"gray.400",children:g<0?"Stock shortage detected":"Stock surplus detected"})]}),e.jsxs(n,{p:4,bg:{base:"gray.900",_light:"gray.50"},borderRadius:"md",borderWidth:"1px",borderColor:{base:"grey.700",_light:"grey.200"},children:[e.jsx(s,{fontSize:"xs",color:{base:"gray.400",_light:"gray.600"},mb:1,children:"Total Sales Amount"}),e.jsxs(s,{fontSize:"xl",fontWeight:"bold",color:"teal.300",children:["KES"," ",(a*parseFloat(r.selling_price)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx(y,{label:"Notes",helperText:"Additional observations",children:e.jsx(f,{value:j,onChange:l=>E(l.target.value),placeholder:"Optional notes"})}),e.jsx(C,{colorScheme:"teal",size:"lg",onClick:N,loading:z.isPending,disabled:a<0||a>d,w:"full",children:"Submit Stock Entry"})]})]})]}):e.jsxs(n,{textAlign:"center",py:12,color:{base:"gray.500",_light:"gray.600"},children:[e.jsx(L,{size:48,style:{margin:"0 auto 16px"}}),e.jsx(s,{fontSize:"lg",children:"No product selected"})]})}function pe({product:r,onSelect:u}){return e.jsxs(n,{p:4,borderWidth:"1px",borderRadius:"md",bg:{base:"gray.900",_light:"white"},borderColor:{base:"gray.700",_light:"gray.200"},_hover:{borderColor:"teal.500",bg:{base:"gray.800",_light:"gray.50"}},transition:"all 0.2s",cursor:"pointer",onClick:u,children:[e.jsxs(Q,{justify:"space-between",align:"start",mb:3,children:[e.jsxs(F,{align:"start",gap:1,flex:1,children:[e.jsx(s,{fontWeight:"bold",fontSize:"md",children:r.name}),e.jsxs(p,{gap:2,children:[e.jsx(k,{colorScheme:"blue",size:"sm",children:r.category.name}),e.jsx(k,{colorScheme:"purple",size:"sm",children:r.status.name})]})]}),e.jsx(C,{size:"sm",variant:"ghost",colorScheme:"teal",onClick:o=>{o.stopPropagation(),u()},children:e.jsx(ne,{})})]}),e.jsxs(H,{templateColumns:"repeat(3, 1fr)",gap:4,children:[e.jsxs(n,{children:[e.jsx(s,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Stock"}),e.jsx(k,{colorScheme:G(r),mt:1,children:r.current_stock})]}),e.jsxs(n,{children:[e.jsx(s,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Status"}),e.jsx(s,{fontSize:"xs",fontWeight:"medium",mt:1,children:xe(r)})]}),e.jsxs(n,{textAlign:"right",children:[e.jsx(s,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Price"}),e.jsxs(s,{fontSize:"sm",fontWeight:"bold",color:"teal.400",mt:1,children:["KES ",parseFloat(r.selling_price).toLocaleString()]})]})]})]})}function ve(){const[r,u]=i.useState(""),[o,S]=i.useState(""),[c,D]=i.useState(null),[T,W]=i.useState(!1),[a,x]=i.useState(1),[m,A]=i.useState(25),[j,E]=i.useState(""),[d,_]=i.useState("");i.useEffect(()=>{const t=setTimeout(()=>{S(r)},300);return()=>clearTimeout(t)},[r]);const{data:g}=q({queryKey:["categories"],queryFn:()=>B.readCategories()}),{data:z}=q({queryKey:["statuses"],queryFn:()=>B.readStatuses()}),{data:N,isLoading:l}=q({queryKey:["products",a,m,o,j,d],queryFn:()=>{const t={skip:(a-1)*m,limit:m};return o.trim()&&(t.name=o.trim()),j&&(t.category_id=j),d&&(t.status_id=d),B.readProducts(t)}}),O=N?.data||[],w=N?.count||0,h=Math.ceil(w/m),I=t=>{D(t),W(!0)},K=()=>{W(!1),setTimeout(()=>D(null),300)},V=()=>{u(""),S(""),E(""),_(""),x(1)};i.useEffect(()=>{x(1)},[o,j,d]);const R=r||j||d;return e.jsxs($,{maxW:"full",minH:"100vh",py:8,children:[e.jsxs(F,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(he,{size:"lg",mb:2,children:"Product Stock Management"}),e.jsxs(s,{color:{base:"gray.500",_light:"gray.600"},children:["Select a product to record stock entry, deliveries, and sales.",w>0&&` Managing ${w} products total.`]})]}),e.jsx(n,{p:4,borderWidth:"1px",borderRadius:"lg",children:e.jsxs(F,{gap:4,align:"stretch",children:[e.jsxs(P,{direction:{base:"column",md:"row"},gap:4,children:[e.jsx(n,{flex:1,children:e.jsx(y,{label:"Search Products",children:e.jsxs(n,{position:"relative",children:[e.jsx(f,{placeholder:"Search by product name only...",value:r,onChange:t=>u(t.target.value),size:"md",pr:r&&r!==o?"10":"4"}),r&&r!==o&&e.jsx(n,{position:"absolute",right:"2",top:"50%",transform:"translateY(-50%)",children:e.jsx(s,{fontSize:"xs",color:"gray.500",children:"⏳"})})]})})}),e.jsx(n,{minW:{base:"full",md:"200px"},children:e.jsx(y,{label:"Category",children:e.jsxs(M,{value:j,onChange:E,children:[e.jsx("option",{value:"",children:"All Categories"}),g?.data.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})}),e.jsx(n,{minW:{base:"full",md:"200px"},children:e.jsx(y,{label:"Status",children:e.jsxs(M,{value:d,onChange:_,children:[e.jsx("option",{value:"",children:"All Statuses"}),z?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})})})]}),e.jsxs(Q,{justify:"space-between",align:"center",children:[e.jsxs(p,{gap:2,children:[e.jsxs(s,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:["Showing ",O.length," of ",w," products",h>1&&` (Page ${a} of ${h})`]}),R&&e.jsxs(p,{gap:1,children:[o&&e.jsxs(k,{colorScheme:"teal",size:"sm",children:['Name: "',o,'"']}),j&&g?.data&&e.jsx(k,{colorScheme:"blue",size:"sm",children:g.data.find(t=>t.id===j)?.name}),d&&z&&e.jsx(k,{colorScheme:"purple",size:"sm",children:z.find(t=>t.id===d)?.name})]})]}),R&&e.jsxs(C,{size:"sm",variant:"ghost",onClick:V,children:[e.jsx(U,{})," Clear Filters"]})]})]})}),l?e.jsx(n,{p:8,textAlign:"center",children:e.jsx(s,{color:{base:"gray.500",_light:"gray.600"},children:"Loading products..."})}):O.length===0?e.jsxs(n,{p:8,textAlign:"center",borderWidth:"1px",borderRadius:"lg",children:[e.jsx(L,{size:48,style:{margin:"0 auto 16px",opacity:.3}}),e.jsx(s,{color:{base:"gray.500",_light:"gray.600"},fontSize:"lg",mb:2,children:"No products found"}),e.jsx(s,{color:{base:"gray.600",_light:"gray.500"},fontSize:"sm",children:R?"Try adjusting your filters":"Add products to get started"})]}):e.jsx(H,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)",xl:"repeat(4, 1fr)"},gap:4,children:e.jsx(ue,{each:O,children:t=>e.jsx(pe,{product:t,onSelect:()=>I(t)},t.id)})}),!l&&h>0&&e.jsx(n,{p:4,borderWidth:"1px",borderRadius:"lg",children:e.jsxs(P,{direction:{base:"column",md:"row"},justify:"space-between",align:"center",gap:4,children:[e.jsxs(p,{gap:2,children:[e.jsx(s,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:"Items per page:"}),e.jsxs(M,{value:m,onChange:t=>{A(Number(t)),x(1)},style:{maxWidth:"80px",fontSize:"14px",padding:"4px"},children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs(s,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:["(",(a-1)*m+1,"-",Math.min(a*m,w)," of ",w,")"]})]}),e.jsxs(p,{gap:2,children:[e.jsx(C,{size:"sm",onClick:()=>x(1),disabled:a===1,variant:"ghost",children:"First"}),e.jsx(C,{size:"sm",onClick:()=>x(t=>Math.max(1,t-1)),disabled:a===1,variant:"ghost",children:e.jsx(X,{})}),e.jsx(p,{gap:1,children:Array.from({length:Math.min(5,h)},(t,v)=>{let b;return h<=5||a<=3?b=v+1:a>=h-2?b=h-4+v:b=a-2+v,e.jsx(C,{size:"sm",variant:a===b?"solid":"ghost",colorScheme:a===b?"teal":"gray",onClick:()=>x(b),minW:"8",children:b},b)})}),e.jsx(C,{size:"sm",onClick:()=>x(t=>Math.min(h,t+1)),disabled:a===h,variant:"ghost",children:e.jsx(Y,{})}),e.jsx(C,{size:"sm",onClick:()=>x(h),disabled:a===h,variant:"ghost",children:"Last"})]}),h>10&&e.jsxs(p,{gap:2,children:[e.jsx(s,{fontSize:"sm",color:"gray.500",children:"Go to page:"}),e.jsx(f,{type:"number",min:"1",max:h,value:a,onChange:t=>{const v=Number(t.target.value);v>=1&&v<=h&&x(v)},w:"20",size:"sm"})]})]})})]}),e.jsxs(J,{open:T,onOpenChange:t=>!t.open&&K(),size:"md",placement:"end",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsxs(re,{borderBottomWidth:"1px",children:[e.jsxs(te,{children:["Add Stock Entry",c&&` - ${c.name}`]}),e.jsx(se,{})]}),e.jsx(ae,{children:e.jsx(me,{selectedProduct:c,onClose:K})})]})]})]})}export{ve as component};
