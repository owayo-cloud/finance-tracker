import{r as D,ad as P,u as E,b as F,b8 as U,h as M,c as A,j as e,ah as x,ai as J,T as O,e as l,f as p,g as V,q as w,bq as v,bb as X,br as Z,bf as ee,bg as se,al as re,bh as ae,C as ie,a as ne,bs as L,ae as le}from"./index-U_CCWg91.js";import{C}from"./checkbox-cm5bkLTg.js";import{D as Q,a as H,b as k,c as I,d as N,e as z,f as B,g as $,h as R,j as te,k as oe,l as de,i as ce}from"./dialog-Dk2vRJpD.js";import{V as K}from"./v-stack-CGRLQPZF.js";import{B as ue,S as y,P as he,a as me,b as xe,c as je}from"./pagination-COuKxq-9.js";import{T as W,a as Y,b as S,c,d as G,e as u}from"./table-ZlS8bbiA.js";import{H as pe}from"./index-B8T0vdp5.js";import{B as ge}from"./badge-DPauIkpv.js";const be=()=>{const[a,n]=D.useState(!1),h=P(),{showSuccessToast:g}=A(),{control:m,register:t,handleSubmit:d,reset:j,getValues:f,formState:{errors:i,isValid:r,isSubmitting:o}}=E({mode:"onBlur",criteriaMode:"all",defaultValues:{email:"",full_name:"",password:"",confirm_password:"",is_superuser:!1,is_active:!1}}),_=F({mutationFn:s=>U.createUser({requestBody:s}),onSuccess:()=>{g("User created successfully."),j(),n(!1)},onError:s=>{M(s)},onSettled:()=>{h.invalidateQueries({queryKey:["users"]})}}),q=s=>{_.mutate(s)};return e.jsxs(Q,{size:{base:"xs",md:"md"},placement:"center",open:a,onOpenChange:({open:s})=>n(s),children:[e.jsx(H,{asChild:!0,children:e.jsxs(x,{value:"add-user",my:4,children:[e.jsx(J,{fontSize:"16px"}),"Add User"]})}),e.jsxs(k,{children:[e.jsxs("form",{onSubmit:d(q),children:[e.jsx(I,{children:e.jsx(N,{children:"Add User"})}),e.jsxs(z,{children:[e.jsx(O,{mb:4,children:"Fill in the form below to add a new user to the system."}),e.jsxs(K,{gap:4,children:[e.jsx(l,{required:!0,invalid:!!i.email,errorText:i.email?.message,label:"Email",children:e.jsx(p,{...t("email",{required:"Email is required",pattern:V}),placeholder:"Email",type:"email"})}),e.jsx(l,{invalid:!!i.full_name,errorText:i.full_name?.message,label:"Full Name",children:e.jsx(p,{...t("full_name"),placeholder:"Full name",type:"text"})}),e.jsx(l,{required:!0,invalid:!!i.password,errorText:i.password?.message,label:"Set Password",children:e.jsx(p,{...t("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),placeholder:"Password",type:"password"})}),e.jsx(l,{required:!0,invalid:!!i.confirm_password,errorText:i.confirm_password?.message,label:"Confirm Password",children:e.jsx(p,{...t("confirm_password",{required:"Please confirm your password",validate:s=>s===f().password||"The passwords do not match"}),placeholder:"Password",type:"password"})})]}),e.jsxs(w,{mt:4,direction:"column",gap:4,children:[e.jsx(v,{control:m,name:"is_superuser",render:({field:s})=>e.jsx(l,{disabled:s.disabled,colorPalette:"teal",children:e.jsx(C,{checked:s.value,onCheckedChange:({checked:b})=>s.onChange(b),children:"Is superuser?"})})}),e.jsx(v,{control:m,name:"is_active",render:({field:s})=>e.jsx(l,{disabled:s.disabled,colorPalette:"teal",children:e.jsx(C,{checked:s.value,onCheckedChange:({checked:b})=>s.onChange(b),children:"Is active?"})})})]})]}),e.jsxs(B,{gap:2,children:[e.jsx($,{asChild:!0,children:e.jsx(x,{variant:"subtle",colorPalette:"gray",disabled:o,children:"Cancel"})}),e.jsx(x,{variant:"solid",type:"submit",disabled:!r,loading:o,children:"Save"})]})]}),e.jsx(R,{})]})]})},fe=({id:a})=>{const[n,h]=D.useState(!1),g=P(),{showSuccessToast:m,showErrorToast:t}=A(),{handleSubmit:d,formState:{isSubmitting:j}}=E(),i=F({mutationFn:async o=>{await U.deleteUser({userId:o})},onSuccess:()=>{m("The user was deleted successfully"),h(!1)},onError:()=>{t("An error occurred while deleting the user")},onSettled:()=>{g.invalidateQueries()}}),r=async()=>{i.mutate(a)};return e.jsxs(Q,{size:{base:"xs",md:"md"},placement:"center",role:"alertdialog",open:n,onOpenChange:({open:o})=>h(o),children:[e.jsx(H,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"sm",colorPalette:"red",children:[e.jsx(X,{fontSize:"16px"}),"Delete User"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:d(r),children:[e.jsx(I,{children:e.jsx(N,{children:"Delete User"})}),e.jsx(z,{children:e.jsxs(O,{mb:4,children:["All items associated with this user will also be"," ",e.jsx("strong",{children:"permanently deleted."})," Are you sure? You will not be able to undo this action."]})}),e.jsxs(B,{gap:2,children:[e.jsx(te,{asChild:!0,children:e.jsx(x,{variant:"subtle",colorPalette:"gray",disabled:j,children:"Cancel"})}),e.jsx(x,{variant:"solid",colorPalette:"red",type:"submit",loading:j,children:"Delete"})]}),e.jsx(R,{})]})})]})},we=({user:a})=>{const[n,h]=D.useState(!1),g=P(),{showSuccessToast:m}=A(),{control:t,register:d,handleSubmit:j,reset:f,getValues:i,formState:{errors:r,isSubmitting:o}}=E({mode:"onBlur",criteriaMode:"all",defaultValues:a}),_=F({mutationFn:s=>U.updateUser({userId:a.id,requestBody:s}),onSuccess:()=>{m("User updated successfully."),f(),h(!1)},onError:s=>{M(s)},onSettled:()=>{g.invalidateQueries({queryKey:["users"]})}}),q=async s=>{s.password===""&&(s.password=void 0),_.mutate(s)};return e.jsxs(oe,{size:{base:"xs",md:"md"},placement:"center",open:n,onOpenChange:({open:s})=>h(s),children:[e.jsx(de,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"sm",children:[e.jsx(Z,{fontSize:"16px"}),"Edit User"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:j(q),children:[e.jsx(I,{children:e.jsx(ce,{children:"Edit User"})}),e.jsxs(z,{children:[e.jsx(O,{mb:4,children:"Update the user details below."}),e.jsxs(K,{gap:4,children:[e.jsx(l,{required:!0,invalid:!!r.email,errorText:r.email?.message,label:"Email",children:e.jsx(p,{...d("email",{required:"Email is required",pattern:V}),placeholder:"Email",type:"email"})}),e.jsx(l,{invalid:!!r.full_name,errorText:r.full_name?.message,label:"Full Name",children:e.jsx(p,{...d("full_name"),placeholder:"Full name",type:"text"})}),e.jsx(l,{invalid:!!r.password,errorText:r.password?.message,label:"Set Password",children:e.jsx(p,{...d("password",{minLength:{value:8,message:"Password must be at least 8 characters"}}),placeholder:"Password",type:"password"})}),e.jsx(l,{invalid:!!r.confirm_password,errorText:r.confirm_password?.message,label:"Confirm Password",children:e.jsx(p,{...d("confirm_password",{validate:s=>s===i().password||"The passwords do not match"}),placeholder:"Password",type:"password"})})]}),e.jsxs(w,{mt:4,direction:"column",gap:4,children:[e.jsx(v,{control:t,name:"is_superuser",render:({field:s})=>e.jsx(l,{disabled:s.disabled,colorPalette:"teal",children:e.jsx(C,{checked:s.value,onCheckedChange:({checked:b})=>s.onChange(b),children:"Is superuser?"})})}),e.jsx(v,{control:t,name:"is_active",render:({field:s})=>e.jsx(l,{disabled:s.disabled,colorPalette:"teal",children:e.jsx(C,{checked:s.value,onCheckedChange:({checked:b})=>s.onChange(b),children:"Is active?"})})})]})]}),e.jsxs(B,{gap:2,children:[e.jsx($,{asChild:!0,children:e.jsx(x,{variant:"subtle",colorPalette:"gray",disabled:o,children:"Cancel"})}),e.jsx(x,{variant:"solid",type:"submit",loading:o,children:"Save"})]}),e.jsx(R,{})]})})]})},ye=({user:a,disabled:n})=>e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(re,{variant:"ghost",color:"inherit",disabled:n,children:e.jsx(ue,{})})}),e.jsxs(ae,{children:[e.jsx(we,{user:a}),e.jsx(fe,{id:a.id})]})]}),ve=()=>e.jsxs(W,{size:{base:"sm",md:"md"},children:[e.jsx(Y,{children:e.jsxs(S,{children:[e.jsx(c,{w:"sm",children:"Full name"}),e.jsx(c,{w:"sm",children:"Email"}),e.jsx(c,{w:"sm",children:"Role"}),e.jsx(c,{w:"sm",children:"Status"}),e.jsx(c,{w:"sm",children:"Actions"})]})}),e.jsx(G,{children:[...Array(5)].map((a,n)=>e.jsxs(S,{children:[e.jsx(u,{children:e.jsx(y,{noOfLines:1})}),e.jsx(u,{children:e.jsx(y,{noOfLines:1})}),e.jsx(u,{children:e.jsx(y,{noOfLines:1})}),e.jsx(u,{children:e.jsx(y,{noOfLines:1})}),e.jsx(u,{children:e.jsx(y,{noOfLines:1})})]},n))})]}),T=5;function Ce({page:a}){return{queryFn:()=>U.readUsers({skip:(a-1)*T,limit:T}),queryKey:["users",{page:a}]}}function Se(){const n=P().getQueryData(["currentUser"]),h=ne({from:L.fullPath}),{page:g}=L.useSearch(),{data:m,isLoading:t,isPlaceholderData:d}=le({...Ce({page:g}),placeholderData:r=>r}),j=r=>{h({to:"/admin",search:o=>({...o,page:r})})},f=m?.data.slice(0,T)??[],i=m?.count??0;return t?e.jsx(ve,{}):e.jsxs(e.Fragment,{children:[e.jsxs(W,{size:{base:"sm",md:"md"},variant:"outline",children:[e.jsx(Y,{children:e.jsxs(S,{children:[e.jsx(c,{w:"sm",children:"Full name"}),e.jsx(c,{w:"sm",children:"Email"}),e.jsx(c,{w:"sm",children:"Role"}),e.jsx(c,{w:"sm",children:"Status"}),e.jsx(c,{w:"sm",children:"Actions"})]})}),e.jsx(G,{children:f?.map(r=>e.jsxs(S,{opacity:d?.5:1,children:[e.jsxs(u,{color:r.full_name?void 0:"gray.500",children:[r.full_name||"N/A",n?.id===r.id&&e.jsx(ge,{ml:"1",colorScheme:"teal",children:"You"})]}),e.jsx(u,{truncate:!0,maxW:"sm",children:r.email}),e.jsx(u,{children:r.is_superuser?"Superuser":"User"}),e.jsx(u,{children:r.is_active?"Active":"Inactive"}),e.jsx(u,{children:e.jsx(ye,{user:r,disabled:n?.id===r.id})})]},r.id))})]}),e.jsx(w,{justifyContent:"flex-end",mt:4,children:e.jsx(he,{count:i,pageSize:T,onPageChange:({page:r})=>j(r),children:e.jsxs(w,{children:[e.jsx(me,{}),e.jsx(xe,{}),e.jsx(je,{})]})})})]})}function Ae(){return e.jsx(ie,{maxW:"full",minH:"100vh",children:e.jsxs(w,{direction:"column",gap:6,pt:12,pb:8,children:[e.jsxs(w,{justify:"space-between",align:"center",children:[e.jsx(pe,{size:"lg",children:"Users Management"}),e.jsx(be,{})]}),e.jsx(Se,{})]})})}export{Ae as component};
