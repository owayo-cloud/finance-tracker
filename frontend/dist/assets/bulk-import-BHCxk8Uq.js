import{a5 as ae,r as y,j as e,bB as je,bN as re,bO as se,bP as fe,b5 as be,a as Se,ad as we,C as ve,l as n,T as o,H as b,q as te,s as u,m as B,ah as g,bQ as ye,bR as Ce,n as ce,bS as oe,bT as K,b as U,c as G,ao as ke,ae as J,bU as de,e as q,f as X,bV as ze,bW as le,bX as Re,ag as ne}from"./index-U_CCWg91.js";import{V as S}from"./v-stack-CGRLQPZF.js";import{H as k}from"./index-B8T0vdp5.js";import{B as P}from"./badge-DPauIkpv.js";import{G as Ie}from"./grid-wa4VYUzx.js";import{T as Fe,a as _e,b as ie,c as T,d as Pe,e as M}from"./table-ZlS8bbiA.js";const[Ae,Ee]=je({name:"AlertStatusContext",hookName:"useAlertStatusContext",providerName:"<Alert />"}),{withProvider:Te,withContext:Y,useStyles:Me}=ae({key:"alert"}),V=Te("div","root",{forwardAsChild:!0,wrapElement(d,h){return e.jsx(Ae,{value:{status:h.status||"info"},children:d})}}),De=Y("div","title"),O=Y("div","description"),N=Y("div","content"),Be={info:re,warning:se,success:fe,error:se,neutral:re},H=y.forwardRef(function(h,r){const c=Ee(),p=Me(),a=typeof c.status=="string"?Be[c.status]:y.Fragment,{children:w=e.jsx(a,{}),...t}=h;return e.jsx(be.span,{ref:r,...t,css:[p.indicator,h.css],children:w})}),{withProvider:Le,withContext:ue}=ae({key:"list"}),$=Le("ul","root",{defaultProps:{role:"list"}}),F=ue("li","item");ue("span","indicator");function We(){const d=Se(),h=we(),[r,c]=y.useState({currentStage:1,sessionId:null,filename:null,totalRows:0,validRows:0,errorRows:0,duplicateRows:0,columns:[],columnMapping:{},autoMapping:{},defaultCategoryId:null,defaultStatusId:null,validatedRows:[],duplicateAction:"skip",importTags:[],importNotes:""}),p=()=>{r.currentStage>1?c({...r,currentStage:r.currentStage-1}):d({to:"/products",search:{page:1,search:"",category:"",status:"",pageSize:25}})},a=()=>{window.confirm("Are you sure you want to cancel the import? All progress will be lost.")&&d({to:"/products",search:{page:1,search:"",category:"",status:"",pageSize:25}})},w=t=>{switch(t){case 1:return"Instructions";case 2:return"Upload File";case 3:return"Map Columns";case 4:return"Review & Fix";case 5:return"Complete";default:return""}};return e.jsx(ve,{maxW:"7xl",py:8,children:e.jsxs(S,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(k,{size:"xl",mb:2,children:"Bulk Product Import"}),e.jsx(o,{color:"fg.muted",children:"Import multiple products at once using CSV or Excel files"})]}),e.jsxs(n,{p:6,borderWidth:"1px",borderRadius:"lg",bg:"bg.panel",children:[e.jsx(b,{gap:4,justify:"space-between",mb:4,children:[1,2,3,4,5].map(t=>e.jsxs(te,{direction:"column",align:"center",flex:1,children:[e.jsx(n,{w:10,h:10,borderRadius:"full",bg:t<r.currentStage?"green.500":t===r.currentStage?"blue.500":"gray.200",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",mb:2,children:t<r.currentStage?e.jsx(u,{as:B}):t}),e.jsx(o,{fontSize:"sm",fontWeight:t===r.currentStage?"bold":"normal",color:t===r.currentStage?"fg.default":"fg.muted",children:w(t)})]},t))}),e.jsx(n,{h:"8px",w:"full",bg:"gray.200",borderRadius:"full",overflow:"hidden",children:e.jsx(n,{h:"full",w:`${r.currentStage/5*100}%`,bg:"blue.500",transition:"width 0.3s"})})]}),e.jsxs(n,{p:8,borderWidth:"1px",borderRadius:"lg",minH:"400px",children:[r.currentStage===1&&e.jsx($e,{onContinue:()=>c({...r,currentStage:2})}),r.currentStage===2&&e.jsx(qe,{onFileUploaded:(t,m,j,C,z)=>{c({...r,sessionId:t,filename:m,totalRows:j,columns:C,autoMapping:z,columnMapping:z,currentStage:3})}}),r.currentStage===3&&e.jsx(Ue,{sessionId:r.sessionId,columns:r.columns,autoMapping:r.autoMapping,totalRows:r.totalRows,onMappingComplete:(t,m,j,C,z,f,R)=>{c({...r,validRows:t,errorRows:m,duplicateRows:j,columnMapping:C,defaultCategoryId:z,defaultStatusId:f,validatedRows:R,currentStage:4})}}),r.currentStage===4&&e.jsx(Ve,{sessionId:r.sessionId,validRows:r.validRows,errorRows:r.errorRows,duplicateRows:r.duplicateRows,validatedRows:r.validatedRows,onImportComplete:(t,m,j)=>{c({...r,validRows:t,errorRows:m,duplicateRows:j,currentStage:5}),h.invalidateQueries({queryKey:["products"]})},duplicateAction:r.duplicateAction,onDuplicateActionChange:t=>c({...r,duplicateAction:t})}),r.currentStage===5&&e.jsx(Oe,{validRows:r.validRows,errorRows:r.errorRows,duplicateRows:r.duplicateRows,sessionId:r.sessionId})]}),e.jsxs(te,{justify:"space-between",children:[e.jsx(g,{variant:"outline",onClick:p,children:e.jsxs(b,{gap:2,children:[e.jsx(u,{as:ye}),e.jsx(o,{children:r.currentStage===1?"Back to Products":"Back"})]})}),e.jsxs(b,{gap:3,children:[e.jsx(g,{variant:"ghost",onClick:a,children:"Cancel"}),r.currentStage===5&&e.jsx(g,{colorScheme:"green",onClick:()=>d({to:"/products",search:{page:1,search:"",category:"",status:"",pageSize:25}}),children:"Back to Products"})]})]})]})})}function $e({onContinue:d}){const{showSuccessToast:h,showErrorToast:r}=G(),c=async()=>{try{const p=await fetch("http://localhost:8000/api/v1/products/bulk/template",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!p.ok)throw new Error("Failed to download template");const a=await p.blob(),w=window.URL.createObjectURL(a),t=document.createElement("a");t.href=w,t.download="product_import_template.csv",document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(w),document.body.removeChild(t),h("Template downloaded successfully!")}catch(p){r("Failed to download template"),console.error("Download error:",p)}};return e.jsxs(S,{gap:6,align:"stretch",children:[e.jsxs(V,{status:"info",children:[e.jsx(H,{children:e.jsx(u,{as:Ce})}),e.jsxs(N,{children:[e.jsx(De,{children:"Before You Begin"}),e.jsx(O,{children:"Make sure you have your product data ready in CSV or Excel format. Download our template below to see the expected format."})]})]}),e.jsxs(n,{children:[e.jsx(k,{size:"md",mb:4,children:"ðŸ“‹ Import Guidelines"}),e.jsxs(S,{gap:4,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(o,{fontWeight:"bold",mb:2,children:"âœ“ Supported Formats"}),e.jsxs($,{pl:6,children:[e.jsx(F,{children:"CSV (Comma-Separated Values)"}),e.jsx(F,{children:"XLSX/XLS (Microsoft Excel)"})]})]}),e.jsxs(n,{children:[e.jsx(o,{fontWeight:"bold",mb:2,children:"âœ“ File Limits"}),e.jsxs($,{pl:6,children:[e.jsx(F,{children:"Maximum file size: 10MB"}),e.jsx(F,{children:"Maximum rows: 1000 products"})]})]}),e.jsxs(n,{children:[e.jsx(o,{fontWeight:"bold",mb:2,children:"âœ“ Required Fields"}),e.jsxs($,{pl:6,children:[e.jsxs(F,{children:[e.jsx(P,{colorScheme:"red",mr:2,children:"Required"}),"Product Name"]}),e.jsxs(F,{children:[e.jsx(P,{colorScheme:"red",mr:2,children:"Required"}),"Selling Price"]})]})]}),e.jsxs(n,{children:[e.jsx(o,{fontWeight:"bold",mb:2,children:"âœ“ Optional Fields"}),e.jsxs($,{pl:6,children:[e.jsx(F,{children:"Buying Price"}),e.jsx(F,{children:"Current Stock"}),e.jsx(F,{children:"Reorder Level"}),e.jsx(F,{children:"Description"})]})]}),e.jsxs(V,{status:"warning",children:[e.jsx(H,{children:e.jsx(u,{as:ce})}),e.jsx(N,{children:e.jsxs(O,{children:[e.jsx("strong",{children:"Note:"})," Category and Status will be assigned during the mapping stage. All imported products will use the same category and status initially."]})})]})]})]}),e.jsx(n,{p:6,borderWidth:"2px",borderRadius:"lg",borderStyle:"dashed",bg:"bg.muted",children:e.jsxs(S,{gap:4,children:[e.jsx(u,{as:oe,boxSize:12,color:"blue.500"}),e.jsx(k,{size:"md",children:"Download Template"}),e.jsx(o,{fontSize:"sm",color:"fg.muted",textAlign:"center",children:"Get our CSV template with sample data to see the expected format"}),e.jsx(g,{colorScheme:"blue",size:"lg",onClick:c,children:e.jsxs(b,{gap:2,children:[e.jsx(u,{as:oe}),e.jsx(o,{children:"Download CSV Template"})]})})]})}),e.jsxs(n,{p:4,bg:"blue.50",borderRadius:"lg",children:[e.jsx(k,{size:"sm",mb:2,color:"blue.800",children:"ðŸ“ Example Data"}),e.jsx(n,{as:"pre",p:3,bg:"white",borderRadius:"md",overflow:"auto",fontSize:"sm",fontFamily:"mono",children:`Product Name,Selling Price,Buying Price,Description
2 Share Sweet Red 750ML,850.00,650.00,Sweet red wine
Coca Cola 300ML,120.00,80.00,Soft drink
Tusker Lager 500ML,200.00,150.00,Beer`})]}),e.jsx(g,{colorScheme:"blue",size:"lg",onClick:d,children:e.jsxs(b,{gap:2,children:[e.jsx(o,{children:"Continue to Upload"}),e.jsx(u,{as:K})]})})]})}function qe({onFileUploaded:d}){const[h,r]=y.useState(!1),[c,p]=y.useState(0),[a,w]=y.useState(null),{showSuccessToast:t,showErrorToast:m}=G(),j=U({mutationFn:async i=>{const x=new FormData;x.append("file",i);const I=await fetch("http://localhost:8000/api/v1/products/bulk/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:x});if(!I.ok){const A=await I.json();throw new Error(A.detail||"Upload failed")}return I.json()},onSuccess:i=>{t(`File uploaded successfully! Found ${i.total_rows} rows.`),d(i.id,i.filename,i.total_rows,i.columns||[],i.auto_mapping||{})},onError:i=>{m(i.message||"Failed to upload file")}}),C=i=>{const x=i.target.files?.[0];if(x){if(x.size>10*1024*1024){m(`File too large. Maximum size is 10MB. Your file: ${(x.size/1024/1024).toFixed(2)}MB`);return}const I=x.name.split(".").pop()?.toLowerCase();if(!["csv","xlsx","xls"].includes(I||"")){m("Invalid file format. Please upload CSV or Excel files only");return}w(x)}},z=async()=>{if(a){r(!0),p(0);try{const i=setInterval(()=>{p(x=>Math.min(x+10,90))},200);await j.mutateAsync(a),clearInterval(i),p(100)}catch(i){console.error("Upload error:",i)}finally{r(!1),p(0)}}},f=i=>{i.preventDefault()},R=i=>{i.preventDefault();const x=i.dataTransfer.files?.[0];x&&C({target:{files:[x]}})};return e.jsxs(S,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(k,{size:"md",mb:2,children:"Step 1 of 5: Upload File"}),e.jsx(o,{color:"fg.muted",children:"Select or drag & drop your CSV/Excel file"})]}),e.jsxs(n,{p:12,borderWidth:"2px",borderRadius:"lg",borderStyle:"dashed",borderColor:a?"green.500":"border.default",bg:a?"green.50":"bg.muted",textAlign:"center",cursor:"pointer",onDragOver:f,onDrop:R,onClick:()=>document.getElementById("file-input")?.click(),children:[e.jsxs(S,{gap:4,children:[e.jsx(u,{as:a?B:ke,boxSize:16,color:a?"green.500":"gray.400"}),a?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"md",color:"green.700",children:a.name}),e.jsxs(o,{color:"fg.muted",children:["Size: ",(a.size/1024).toFixed(2)," KB"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:i=>{i.stopPropagation(),w(null)},children:"Change File"})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"md",children:"Drag & drop your file here"}),e.jsx(o,{color:"fg.muted",children:"or"}),e.jsx(g,{colorScheme:"blue",size:"lg",children:"Select File"}),e.jsx(o,{fontSize:"sm",color:"fg.muted",children:"Supported: CSV, Excel (max 10MB)"})]})]}),e.jsx("input",{id:"file-input",type:"file",accept:".csv,.xlsx,.xls",hidden:!0,onChange:C})]}),h&&e.jsxs(n,{children:[e.jsxs(o,{mb:2,children:["Uploading and processing: ",c,"%"]}),e.jsx(n,{h:"8px",w:"full",bg:"gray.200",borderRadius:"full",overflow:"hidden",children:e.jsx(n,{h:"full",w:`${c}%`,bg:"blue.500",transition:"width 0.3s"})}),e.jsx(o,{fontSize:"sm",color:"fg.muted",mt:2,children:"Please wait while we parse your file..."})]}),a&&!h&&e.jsx(g,{colorScheme:"blue",size:"lg",onClick:z,loading:j.isPending,children:e.jsxs(b,{gap:2,children:[e.jsx(o,{children:"Continue to Column Mapping"}),e.jsx(u,{as:K})]})})]})}function Ue({sessionId:d,columns:h,autoMapping:r,totalRows:c,onMappingComplete:p}){const[a,w]=y.useState(r),[t,m]=y.useState(""),[j,C]=y.useState(""),{showSuccessToast:z,showErrorToast:f}=G(),{data:R,isLoading:i}=J({queryKey:["categories"],queryFn:()=>ne.readCategories()}),{data:x,isLoading:I}=J({queryKey:["statuses"],queryFn:()=>ne.readStatuses()}),A=U({mutationFn:async()=>{const l=await fetch("http://localhost:8000/api/v1/products/bulk/map-columns",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({session_id:d,column_mapping:a,default_category_id:t||null,default_status_id:j||null})});if(!l.ok){const E=await l.json();throw new Error(E.detail||"Column mapping failed")}return l.json()},onSuccess:l=>{z("Column mapping complete! Validation successful."),p(l.valid_rows,l.error_rows,l.duplicate_rows,a,t,j,[])},onError:l=>{f(l.message||"Failed to map columns")}}),L=()=>{const l=Object.values(a).includes("name"),E=Object.values(a).includes("selling_price");if(!l){f("Please map the Product Name field");return}if(!E){f("Please map the Selling Price field");return}if(!t){f("Please select a category for all products");return}if(!j){f("Please select a status for all products");return}A.mutate()},W=[{value:"name",label:"Product Name *",required:!0},{value:"selling_price",label:"Selling Price *",required:!0},{value:"buying_price",label:"Buying Price",required:!1},{value:"current_stock",label:"Current Stock",required:!1},{value:"reorder_level",label:"Reorder Level",required:!1},{value:"description",label:"Description",required:!1},{value:"",label:"(Skip this column)",required:!1}];return i||I?e.jsxs(S,{gap:6,children:[e.jsx(de,{size:"xl"}),e.jsx(o,{children:"Loading categories and statuses..."})]}):e.jsxs(S,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(k,{size:"md",mb:2,children:"Step 2 of 5: Map Columns"}),e.jsxs(o,{color:"fg.muted",children:["Map your spreadsheet columns to our system fields. Found ",c," rows."]})]}),e.jsxs(V,{status:"info",children:[e.jsx(H,{children:e.jsx(u,{as:B})}),e.jsx(N,{children:e.jsx(O,{children:"Columns with âœ“ have been auto-matched. Review and adjust mappings as needed."})})]}),e.jsxs(n,{children:[e.jsx(k,{size:"sm",mb:4,children:"Column Mapping"}),e.jsx(S,{gap:3,align:"stretch",children:h.map((l,E)=>{const Q=r[l]!==void 0;return e.jsxs(Ie,{templateColumns:"1fr 2fr",gap:4,alignItems:"center",children:[e.jsxs(b,{children:[Q&&e.jsx(u,{as:B,color:"green.500"}),e.jsx(o,{fontWeight:"medium",children:l})]}),e.jsx(q,{children:e.jsxs("select",{value:a[l]||"",onChange:_=>{w({...a,[l]:_.target.value})},style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)"},children:[e.jsx("option",{value:"",children:"-- Select Field --"}),W.map(_=>e.jsx("option",{value:_.value,children:_.label},_.value))]})})]},E)})})]}),e.jsxs(n,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"blue.50",children:[e.jsx(k,{size:"sm",mb:4,color:"blue.800",children:"Required Fields for All Products"}),e.jsxs(S,{gap:4,align:"stretch",children:[e.jsx(q,{label:"Category *",required:!0,children:e.jsxs("select",{value:t,onChange:l=>m(l.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)"},children:[e.jsx("option",{value:"",children:"-- Select Category --"}),R?.data.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})}),e.jsx(q,{label:"Status *",required:!0,children:e.jsxs("select",{value:j,onChange:l=>C(l.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)"},children:[e.jsx("option",{value:"",children:"-- Select Status --"}),x?.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})})]})]}),e.jsx(g,{colorScheme:"blue",size:"lg",onClick:L,loading:A.isPending,children:e.jsxs(b,{gap:2,children:[e.jsx(o,{children:"Continue to Validation"}),e.jsx(u,{as:K})]})})]})}function Ve({sessionId:d,validRows:h,errorRows:r,duplicateRows:c,validatedRows:p,onImportComplete:a,duplicateAction:w,onDuplicateActionChange:t}){const[m,j]=y.useState("all"),[C,z]=y.useState(null),[f,R]=y.useState({}),[i,x]=y.useState(!1),[I,A]=y.useState(0),{showSuccessToast:L,showErrorToast:W}=G(),{data:l,isLoading:E,refetch:Q}=J({queryKey:["bulk-import-validation",d,m],queryFn:async()=>{const s=await fetch(`http://localhost:8000/api/v1/products/bulk/validate/${d}?filter=${m}&limit=1000`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!s.ok)throw new Error("Failed to fetch validation results");return s.json()},enabled:p.length===0}),_=l?.rows||p,Z=U({mutationFn:async({rowNumber:s,updatedData:v})=>{const D=await fetch(`http://localhost:8000/api/v1/products/bulk/fix-row/${d}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({session_id:d,row_number:s,updated_data:v})});if(!D.ok)throw new Error("Failed to fix row");return D.json()},onSuccess:()=>{L("Row fixed successfully!"),z(null),R({}),Q()},onError:()=>{W("Failed to fix row")}}),ee=U({mutationFn:async()=>{const s=await fetch(`http://localhost:8000/api/v1/products/bulk/import/${d}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({session_id:d,skip_errors:!0,duplicate_action:w,tags:[],notes:""})});if(!s.ok)throw new Error("Import failed");return s.json()},onSuccess:s=>{L(`Import complete! ${s.success_count} products imported successfully.`),a(s.success_count,s.error_count,s.duplicate_count)},onError:()=>{W("Import failed"),x(!1)}}),he=s=>{z(s.row_number),R(s.mapped_data||s.data)},pe=s=>{Z.mutate({rowNumber:s,updatedData:f})},xe=()=>{z(null),R({})},ge=()=>{x(!0),A(0);const s=setInterval(()=>{A(v=>Math.min(v+10,90))},500);ee.mutate(),setTimeout(()=>{clearInterval(s),A(100)},5e3)},me=s=>{switch(s){case"valid":return e.jsx(u,{as:B,color:"green.500"});case"warning":return e.jsx(u,{as:le,color:"orange.500"});case"error":return e.jsx(u,{as:ce,color:"red.500"});case"duplicate":return e.jsx(u,{as:Re,color:"blue.500"});default:return null}};return E?e.jsxs(S,{gap:6,children:[e.jsx(de,{size:"xl"}),e.jsx(o,{children:"Loading validation results..."})]}):e.jsxs(S,{gap:6,align:"stretch",children:[e.jsxs(n,{children:[e.jsx(k,{size:"md",mb:2,children:"Step 3 of 5: Review & Fix Errors"}),e.jsx(o,{color:"fg.muted",children:"Review the validation results and fix any errors before importing"})]}),e.jsxs(b,{gap:4,justify:"center",p:4,borderWidth:"1px",borderRadius:"lg",children:[e.jsxs(P,{colorScheme:"gray",fontSize:"lg",px:4,py:2,children:["ðŸ“Š Total: ",_.length]}),e.jsxs(P,{colorScheme:"green",fontSize:"lg",px:4,py:2,children:["âœ“ Valid: ",h]}),e.jsxs(P,{colorScheme:"red",fontSize:"lg",px:4,py:2,children:["âŒ Errors: ",r]}),e.jsxs(P,{colorScheme:"orange",fontSize:"lg",px:4,py:2,children:["ðŸ”„ Duplicates: ",c]})]}),e.jsxs(b,{gap:3,children:[e.jsxs(g,{variant:m==="all"?"solid":"outline",onClick:()=>j("all"),children:["Show All (",_.length,")"]}),e.jsxs(g,{variant:m==="errors"?"solid":"outline",colorScheme:"red",onClick:()=>j("errors"),children:["Errors Only (",r,")"]}),e.jsxs(g,{variant:m==="duplicates"?"solid":"outline",colorScheme:"orange",onClick:()=>j("duplicates"),children:["Duplicates Only (",c,")"]})]}),c>0&&e.jsxs(n,{p:4,borderWidth:"1px",borderRadius:"lg",bg:"orange.50",children:[e.jsx(k,{size:"sm",mb:3,children:"Duplicate Handling"}),e.jsx(q,{label:"What should we do with duplicates?",children:e.jsxs("select",{value:w,onChange:s=>t(s.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)"},children:[e.jsx("option",{value:"skip",children:"Skip duplicates (keep existing products)"}),e.jsx("option",{value:"update",children:"Update existing products with new data"}),e.jsx("option",{value:"create",children:"Import as new products (create duplicates)"})]})})]}),e.jsx(n,{maxH:"500px",overflowY:"auto",borderWidth:"1px",borderRadius:"lg",children:e.jsxs(Fe,{size:"sm",children:[e.jsx(_e,{children:e.jsxs(ie,{children:[e.jsx(T,{children:"Row"}),e.jsx(T,{children:"Status"}),e.jsx(T,{children:"Product Name"}),e.jsx(T,{children:"Selling Price"}),e.jsx(T,{children:"Buying Price"}),e.jsx(T,{children:"Issues"}),e.jsx(T,{children:"Actions"})]})}),e.jsx(Pe,{children:_.slice(0,100).map(s=>e.jsxs(ie,{children:[e.jsx(M,{children:s.row_number}),e.jsx(M,{children:me(s.status)}),e.jsx(M,{children:C===s.row_number?e.jsx(X,{size:"sm",value:f.name||"",onChange:v=>R({...f,name:v.target.value})}):e.jsx(o,{children:s.mapped_data?.name||s.data.name||"-"})}),e.jsx(M,{children:C===s.row_number?e.jsx(X,{size:"sm",type:"number",value:f.selling_price||"",onChange:v=>R({...f,selling_price:v.target.value})}):e.jsx(o,{children:s.mapped_data?.selling_price||s.data.selling_price||"-"})}),e.jsx(M,{children:C===s.row_number?e.jsx(X,{size:"sm",type:"number",value:f.buying_price||"",onChange:v=>R({...f,buying_price:v.target.value})}):e.jsx(o,{children:s.mapped_data?.buying_price||s.data.buying_price||"-"})}),e.jsxs(M,{children:[s.errors.length>0&&e.jsx(S,{align:"start",gap:1,children:s.errors.map((v,D)=>e.jsxs(o,{fontSize:"xs",color:"red.600",children:[v.field,": ",v.message]},D))}),s.warnings.length>0&&e.jsx(S,{align:"start",gap:1,children:s.warnings.map((v,D)=>e.jsxs(o,{fontSize:"xs",color:"orange.600",children:["âš ï¸ ",v]},D))}),s.is_duplicate&&e.jsx(o,{fontSize:"xs",color:"blue.600",children:"ðŸ”„ Duplicate product"})]}),e.jsx(M,{children:C===s.row_number?e.jsxs(b,{gap:1,children:[e.jsx(g,{size:"xs",colorScheme:"green",onClick:()=>pe(s.row_number),loading:Z.isPending,children:"Save"}),e.jsx(g,{size:"xs",variant:"ghost",onClick:xe,children:"Cancel"})]}):s.status==="error"&&e.jsx(g,{size:"xs",variant:"outline",onClick:()=>he(s),children:e.jsxs(b,{gap:1,children:[e.jsx(u,{as:ze}),e.jsx(o,{children:"Fix"})]})})})]},s.row_number))})]})}),i&&e.jsxs(n,{children:[e.jsxs(o,{mb:2,children:["Importing products: ",I,"%"]}),e.jsx(n,{h:"8px",w:"full",bg:"gray.200",borderRadius:"full",overflow:"hidden",children:e.jsx(n,{h:"full",w:`${I}%`,bg:"blue.500",transition:"width 0.3s"})}),e.jsx(o,{fontSize:"sm",color:"fg.muted",mt:2,children:"Please don't close this window..."})]}),e.jsxs(b,{justify:"space-between",children:[r>0&&e.jsxs(V,{status:"warning",children:[e.jsx(H,{children:e.jsx(u,{as:le})}),e.jsx(N,{children:e.jsxs(O,{children:[r," row(s) have errors and will be skipped during import"]})})]}),e.jsx(g,{colorScheme:"green",size:"lg",onClick:ge,loading:ee.isPending||i,disabled:h===0,children:e.jsxs(b,{gap:2,children:[e.jsx(o,{children:r>0?"Import Valid Rows":"Import All Products"}),e.jsx(u,{as:K})]})})]})]})}function Oe({validRows:d,errorRows:h,duplicateRows:r,sessionId:c}){return e.jsxs(S,{gap:8,align:"center",py:8,children:[e.jsx(u,{as:B,boxSize:24,color:"green.500"}),e.jsx(k,{size:"2xl",children:"Import Complete! âœ“"}),e.jsxs(n,{textAlign:"center",children:[e.jsx(o,{fontSize:"lg",fontWeight:"bold",mb:4,children:"Import Summary"}),e.jsxs(S,{gap:3,children:[e.jsx(b,{children:e.jsxs(P,{colorScheme:"green",px:4,py:2,fontSize:"md",children:["âœ“ ",d," products imported successfully"]})}),h>0&&e.jsx(b,{children:e.jsxs(P,{colorScheme:"red",px:4,py:2,fontSize:"md",children:["âŒ ",h," rows skipped due to errors"]})}),r>0&&e.jsx(b,{children:e.jsxs(P,{colorScheme:"orange",px:4,py:2,fontSize:"md",children:["ðŸ”„ ",r," duplicates handled"]})})]})]}),e.jsxs(o,{color:"fg.muted",fontSize:"sm",children:["Import Session ID: ",c]}),e.jsxs(S,{gap:3,width:"100%",maxW:"md",children:[e.jsx(g,{colorScheme:"blue",size:"lg",width:"full",onClick:()=>window.location.href="/products",children:"View Imported Products"}),e.jsx(g,{variant:"outline",size:"lg",width:"full",onClick:()=>window.location.reload(),children:"Import Another File"})]})]})}const Je=We;export{Je as component};
