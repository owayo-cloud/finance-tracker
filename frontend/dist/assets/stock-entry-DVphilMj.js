import{E as it,J as lt,K as ct,M as dt,r as a,N as ye,O as h,j as e,Q as j,R as pe,S as U,U as se,V as oe,W as Se,X as ve,Y as Ce,Z as ut,_ as pt,$ as Pe,a0 as ne,a1 as ae,a2 as ie,a3 as gt,a4 as ht,a5 as we,a6 as mt,a7 as xt,a8 as ft,a9 as jt,aa as Te,ab as bt,ac as yt,ad as ke,ae as Q,u as St,b as _e,h as te,c as ze,af as vt,ag as K,ah as de,ai as Ct,T as p,e as S,f as _,H as w,s as Pt,aj as wt,l as f,ak as Tt,al as kt,am as _t,q as re,an as zt,k as It,C as Rt,B as L,ao as Ft,ap as me,aq as At,w as Ie,ar as Nt,as as qt,at as Dt,au as Ot,av as Et,aw as Lt,ax as Wt,ay as Vt,az as $t,aA as Bt,aB as Gt}from"./index-U_CCWg91.js";import{D as Mt,a as Ht,b as Kt,c as Qt,d as Ut,e as Yt,f as Jt,g as Xt,h as Zt}from"./dialog-Dk2vRJpD.js";import{G as ge}from"./grid-wa4VYUzx.js";import{V as $}from"./v-stack-CGRLQPZF.js";import{H as er}from"./index-B8T0vdp5.js";import{B as W}from"./badge-DPauIkpv.js";import{S as tr}from"./separator-CWDodbLO.js";const ee=t=>new it(t);var rr=t=>{if(!t)return;const r=lt(t),o=ct(t),s=dt(t),n=()=>{requestAnimationFrame(()=>{t.style.height="auto";let g;r.boxSizing==="content-box"?g=t.scrollHeight-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):g=t.scrollHeight+parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth),r.maxHeight!=="none"&&g>parseFloat(r.maxHeight)?(r.overflowY==="hidden"&&(t.style.overflowY="scroll"),g=parseFloat(r.maxHeight)):r.overflowY!=="hidden"&&(t.style.overflowY="hidden"),t.style.height=`${g}px`})};t.addEventListener("input",n),t.form?.addEventListener("reset",n);const c=Object.getPrototypeOf(t),d=Object.getOwnPropertyDescriptor(c,"value");Object.defineProperty(t,"value",{...d,set(){d?.set?.apply(this,arguments),n()}});const m=new o.ResizeObserver(()=>{requestAnimationFrame(()=>n())});m.observe(t);const b=new o.MutationObserver(()=>n());return b.observe(t,{attributes:!0,attributeFilter:["rows","placeholder"]}),s.fonts?.addEventListener("loadingdone",n),()=>{t.removeEventListener("input",n),t.form?.removeEventListener("reset",n),s.fonts?.removeEventListener("loadingdone",n),m.disconnect(),b.disconnect()}};const Re=a.forwardRef((t,r)=>{const{autoresize:o,...s}=t,n=a.useRef(null),c=ye(),d=h(c?.getTextareaProps(),{style:{resize:o?"none":void 0}},s);return a.useEffect(()=>{if(o)return rr(n.current)},[o]),e.jsx(j.textarea,{...d,ref:pe(r,n)})});Re.displayName="FieldTextarea";const[Fe,N]=U({name:"SelectContext",hookName:"useSelectContext",providerName:"<SelectProvider />"}),Ae=a.forwardRef((t,r)=>{const o=N(),s=h(o.getClearTriggerProps(),t);return e.jsx(j.button,{...s,ref:r})});Ae.displayName="SelectClearTrigger";const Ne=a.forwardRef((t,r)=>{const o=N(),s=se(),n=h(o.getContentProps(),s.getPresenceProps(),t);return s.unmounted?null:e.jsx(j.div,{...n,ref:pe(s.ref,r)})});Ne.displayName="SelectContent";const qe=a.forwardRef((t,r)=>{const o=N(),s=h(o.getControlProps(),t);return e.jsx(j.div,{...s,ref:r})});qe.displayName="SelectControl";const De=a.forwardRef((t,r)=>{const o=N(),s=h(o.getIndicatorProps(),t);return e.jsx(j.div,{...s,ref:r})});De.displayName="SelectIndicator";const[sr,Lr]=U({name:"SelectItemContext",hookName:"useSelectItemContext",providerName:"<SelectItemProvider />"}),[or,Oe]=U({name:"SelectItemPropsContext",hookName:"useSelectItemPropsContext",providerName:"<SelectItemPropsProvider />"}),Ee=a.forwardRef((t,r)=>{const[o,s]=oe()(t,["item","persistFocus"]),n=N(),c=h(n.getItemProps(o),s),d=n.getItemState(o);return e.jsx(or,{value:o,children:e.jsx(sr,{value:d,children:e.jsx(j.div,{...c,ref:r})})})});Ee.displayName="SelectItem";const[nr,ar]=U({name:"SelectItemGroupPropsContext",hookName:"useSelectItemGroupPropsContext",providerName:"<SelectItemGroupPropsProvider />"}),Le=a.forwardRef((t,r)=>{const o=a.useId(),[s,n]=oe()(t,["id"]),c={id:o,...s},d=N(),m=h(d.getItemGroupProps(c),n);return e.jsx(nr,{value:c,children:e.jsx(j.div,{...m,ref:r})})});Le.displayName="SelectItemGroup";const We=a.forwardRef((t,r)=>{const o=N(),s=ar(),n=h(o.getItemGroupLabelProps({htmlFor:s.id}),t);return e.jsx(j.div,{...n,ref:r})});We.displayName="SelectItemGroupLabel";const Ve=a.forwardRef((t,r)=>{const o=N(),s=Oe(),n=h(o.getItemIndicatorProps(s),t);return e.jsx(j.div,{...n,ref:r})});Ve.displayName="SelectItemIndicator";const $e=a.forwardRef((t,r)=>{const o=N(),s=Oe(),n=h(o.getItemTextProps(s),t);return e.jsx(j.span,{...n,ref:r})});$e.displayName="SelectItemText";const Be=a.forwardRef((t,r)=>{const o=N(),s=h(o.getLabelProps(),t);return e.jsx(j.label,{...s,ref:r})});Be.displayName="SelectLabel";const Ge=a.forwardRef((t,r)=>{const o=N(),s=h(o.getPositionerProps(),t);return se().unmounted?null:e.jsx(j.div,{...s,ref:r})});Ge.displayName="SelectPositioner";const ir=t=>{const r=a.useId(),{dir:o}=Se(),{getRootNode:s}=ve(),n=ye(),c={id:r,ids:{label:n?.ids.label,hiddenSelect:n?.ids.control},disabled:n?.disabled,readOnly:n?.readOnly,invalid:n?.invalid,required:n?.required,dir:o,getRootNode:s,...t},d=Ce(ut,c);return pt(d,Pe)},lr=(t,r)=>{const[o,s]=ne(t),[n,c]=oe()(s,["closeOnSelect","collection","composite","defaultHighlightedValue","defaultOpen","defaultValue","deselectable","disabled","form","highlightedValue","id","ids","invalid","loopFocus","multiple","name","onFocusOutside","onHighlightChange","onInteractOutside","onOpenChange","onPointerDownOutside","onSelect","onValueChange","open","positioning","readOnly","required","scrollToIndexFn","value"]),d=ir(n),m=ae(h({present:d.open},o)),b=h(d.getRootProps(),c);return e.jsx(Fe,{value:d,children:e.jsx(ie,{value:m,children:e.jsx(j.div,{...b,ref:r})})})},cr=a.forwardRef(lr),dr=(t,r)=>{const[o,s]=ne(t),[{value:n},c]=oe()(s,["value"]),d=ae(h({present:n.open},o)),m=h(n.getRootProps(),c);return e.jsx(Fe,{value:n,children:e.jsx(ie,{value:d,children:e.jsx(j.div,{...m,ref:r})})})},ur=a.forwardRef(dr),Me=a.forwardRef((t,r)=>{const o=N(),s=h(o.getTriggerProps(),t);return e.jsx(j.button,{...s,ref:r})});Me.displayName="SelectTrigger";const He=a.forwardRef((t,r)=>{const{children:o,placeholder:s,...n}=t,c=N(),d=h(c.getValueTextProps(),n);return e.jsx(j.span,{...d,ref:r,children:o||c.valueAsString||s})});He.displayName="SelectValueText";const[Ke,Y]=U({name:"TooltipContext",hookName:"useTooltipContext",providerName:"<TooltipProvider />"}),Qe=a.forwardRef((t,r)=>{const o=Y(),s=h(o.getArrowProps(),t);return e.jsx(j.div,{...s,ref:r})});Qe.displayName="TooltipArrow";const Ue=a.forwardRef((t,r)=>{const o=Y(),s=h(o.getArrowTipProps(),t);return e.jsx(j.div,{...s,ref:r})});Ue.displayName="TooltipArrowTip";const Ye=a.forwardRef((t,r)=>{const o=Y(),s=se(),n=h(o.getContentProps(),s.getPresenceProps(),t);return s.unmounted?null:e.jsx(j.div,{...n,ref:pe(s.ref,r)})});Ye.displayName="TooltipContent";const Je=a.forwardRef((t,r)=>{const o=Y(),s=h(o.getPositionerProps(),t);return se().unmounted?null:e.jsx(j.div,{...s,ref:r})});Je.displayName="TooltipPositioner";const pr=t=>{const r=a.useId(),{getRootNode:o}=ve(),{dir:s}=Se(),n={id:r,dir:s,getRootNode:o,...t},c=Ce(gt,n);return ht(c,Pe)},gr=t=>{const[r,{children:o,...s}]=ne(t),n=pr(s),c=ae(h({present:n.open},r));return e.jsx(Ke,{value:n,children:e.jsx(ie,{value:c,children:o})})},hr=t=>{const[r,{value:o,children:s}]=ne(t),n=ae(h({present:o.open},r));return e.jsx(Ke,{value:o,children:e.jsx(ie,{value:n,children:s})})},Xe=a.forwardRef((t,r)=>{const o=Y(),s=h(o.getTriggerProps(),t);return e.jsx(j.button,{...s,ref:r})});Xe.displayName="TooltipTrigger";function mr(t){const{each:r,fallback:o,children:s}=t;return r?.length===0?o||null:r?.map(s)}const{withProvider:Ze,withContext:z}=we({key:"select"});Ze(ur,"root",{forwardAsChild:!0});const xe=Ze(cr,"root",{forwardAsChild:!0,defaultProps:{positioning:{sameWidth:!0}}}),fe=z(Me,"trigger",{forwardAsChild:!0});z(Ge,"positioner",{forwardAsChild:!0});const je=z(Ne,"content",{forwardAsChild:!0}),be=z(He,"valueText",{forwardAsChild:!0});z(Ae,"clearTrigger",{forwardAsChild:!0,defaultProps:{children:e.jsx(mt,{boxSize:"1em"})}});z(Le,"itemGroup",{forwardAsChild:!0});z(We,"itemGroupLabel",{forwardAsChild:!0});const H=z(Ee,"item",{forwardAsChild:!0});z($e,"itemText",{forwardAsChild:!0});z(Ve,"itemIndicator",{forwardAsChild:!0,defaultProps:{children:e.jsx(xt,{})}});z("div","indicatorGroup");z(De,"indicator",{forwardAsChild:!0,defaultProps:{children:e.jsx(ft,{})}});z(qe,"control",{forwardAsChild:!0});z(Be,"label",{forwardAsChild:!0});const xr=a.forwardRef(function(r,o){const{columns:s,minChildWidth:n,...c}=r,d=jt(),m=n?jr(n,d):br(s);return e.jsx(ge,{ref:o,templateColumns:m,...c})});function fr(t){return typeof t=="number"?`${t}px`:t}function jr(t,r){return Te(t,o=>{const s=r.tokens.getVar(`sizes.${o}`,fr(o));return o===null?null:`repeat(auto-fit, minmax(${s}, 1fr))`})}function br(t){return Te(t,r=>r===null?null:`repeat(${r}, minmax(0, 1fr))`)}const{withContext:yr}=bt({key:"textarea"}),Sr=yr(Re),{withRootProvider:et,withContext:J}=we({key:"tooltip"});et(hr);const vr=et(gr,{defaultProps:{lazyMount:!0,unmountOnExit:!0}}),Cr=J(Xe,"trigger",{forwardAsChild:!0}),Pr=J(Je,"positioner",{forwardAsChild:!0}),wr=J(Ye,"content",{forwardAsChild:!0}),tt=J(Ue,"arrowTip",{forwardAsChild:!0}),Tr=J(Qe,"arrow",{forwardAsChild:!0,defaultProps:{children:e.jsx(tt,{})}}),kr=a.forwardRef(function(r,o){const{showArrow:s,children:n,disabled:c,portalled:d,content:m,contentProps:b,portalRef:g,...v}=r;return c?n:e.jsxs(vr,{...v,children:[e.jsx(Cr,{asChild:!0,children:n}),e.jsx(yt,{disabled:!d,container:g,children:e.jsx(Pr,{children:e.jsxs(wr,{ref:o,...b,children:[s&&e.jsx(Tr,{children:e.jsx(tt,{})}),m]})})})]})}),_r=()=>{const[t,r]=a.useState(!1),[o,s]=a.useState(null),[n,c]=a.useState(null),[d,m]=a.useState(!1),[b,g]=a.useState(""),[v,I]=a.useState(""),R=a.useRef(null),F=ke(),{showSuccessToast:O}=ze(),T=i=>{const C=i.replace(/[^\d.]/g,"").split(".");return C[0]=C[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),C.length>1?`${C[0]}.${C[1].slice(0,2)}`:C[0]},k=i=>{const u=i.replace(/,/g,"");return parseFloat(u)||0},{data:E,isLoading:B}=Q({queryKey:["categories"],queryFn:()=>K.readCategories()}),{data:x,isLoading:X}=Q({queryKey:["statuses"],queryFn:()=>K.readStatuses()}),{register:A,handleSubmit:V,reset:P,setValue:G,formState:{errors:y,isValid:le,isSubmitting:M}}=St({mode:"onBlur",criteriaMode:"all",defaultValues:{name:"",description:"",buying_price:0,selling_price:0,current_stock:1,reorder_level:0,category_id:"",status_id:"",image_id:void 0}});a.useEffect(()=>{A("category_id",{required:"Category is required"}),A("status_id",{required:"Status is required"}),A("buying_price",{required:"Buying price is required.",validate:i=>(typeof i=="string"?parseFloat(i):i)<=0?"Buying price must be greater than 0":!0}),A("selling_price",{required:"Selling price is required.",validate:(i,u)=>{const C=typeof i=="string"?parseFloat(i):i,Z=typeof u.buying_price=="string"?parseFloat(u.buying_price):u.buying_price;return C<=0?"Selling price must be greater than 0":C<=Z?"Selling price must be greater than buying price":!0}})},[A]);const l=a.useMemo(()=>E?.data?ee({items:E.data.map(i=>({label:i.name,value:String(i.id)}))}):ee({items:[]}),[E]),q=a.useMemo(()=>ee(x?{items:x.map(i=>({label:i.name,value:String(i.id)}))}:{items:[]}),[x]),D=_e({mutationFn:async i=>{let u=i.image_id;if(o){m(!0);try{new FormData().append("file",o),u=(await vt.uploadImage({formData:{file:o}})).id}catch(C){throw m(!1),C}m(!1)}return K.createProduct({requestBody:{...i,image_id:u}})},onSuccess:()=>{O("Product created successfully."),P(),s(null),c(null),g(""),I(""),r(!1)},onError:i=>{te(i)},onSettled:()=>{F.invalidateQueries({queryKey:["products"]})}}),st=i=>{const u=i.target.files?.[0];if(u){const C=["image/jpeg","image/jpg","image/png"],Z=[".jpg",".jpeg",".png"],he=u.name.toLowerCase(),at=he.substring(he.lastIndexOf("."));if(!C.includes(u.type)||!Z.includes(at)){te({}),R.current&&(R.current.value="");return}if(u.size>5*1024*1024){te({}),R.current&&(R.current.value="");return}s(u);const ce=new FileReader;ce.onloadend=()=>{c(ce.result)},ce.readAsDataURL(u)}},ot=()=>{s(null),c(null),R.current&&(R.current.value="")},nt=i=>{D.mutate(i)};return e.jsxs(Mt,{size:"xl",placement:"center",open:t,onOpenChange:({open:i})=>r(i),children:[e.jsx(Ht,{asChild:!0,children:e.jsxs(de,{value:"add-product",my:4,colorScheme:"teal",size:"md",children:[e.jsx(Ct,{})," Add Product"]})}),e.jsxs(Kt,{maxWidth:"800px",children:[e.jsxs("form",{onSubmit:V(nt),children:[e.jsxs(Qt,{pb:4,children:[e.jsx(Ut,{fontSize:"xl",fontWeight:"bold",children:"Add New Product"}),e.jsx(p,{fontSize:"sm",color:"gray.600",mt:1,children:"Fill in the details to add a new product to your inventory."})]}),e.jsx(Yt,{children:e.jsxs(xr,{columns:2,gap:6,children:[e.jsxs($,{gap:4,align:"stretch",children:[e.jsx(S,{required:!0,invalid:!!y.name,errorText:y.name?.message,label:"Product Name",children:e.jsx(_,{...A("name",{required:"Product name is required."}),placeholder:"Enter product name",size:"md",borderRadius:"md"})}),e.jsx(S,{invalid:!!y.description,errorText:y.description?.message,label:"Description",children:e.jsx(Sr,{...A("description"),placeholder:"Enter product description (optional)",size:"md",borderRadius:"md",rows:3})}),e.jsx(S,{required:!0,invalid:!!y.category_id,errorText:y.category_id?.message,label:"Category",children:e.jsxs(xe,{collection:l,size:"md",onValueChange:i=>{const u=i.value[0];u&&u!=="loading"&&u!=="none"&&G("category_id",u,{shouldValidate:!0})},children:[e.jsx(fe,{borderRadius:"md",children:e.jsx(be,{placeholder:"Select a category"})}),e.jsx(je,{children:B?e.jsx(H,{item:{label:"Loading categories...",value:"loading"},children:"Loading categories..."}):l.items.length>0?l.items.map(i=>e.jsx(H,{item:i,children:i.label},i.value)):e.jsx(H,{item:{label:"No categories available",value:"none"},children:"No categories available"})})]})}),e.jsx(S,{required:!0,invalid:!!y.status_id,errorText:y.status_id?.message,label:"Status",children:e.jsxs(xe,{collection:q,size:"md",onValueChange:i=>{const u=i.value[0];u&&u!=="loading"&&u!=="none"&&G("status_id",u,{shouldValidate:!0})},children:[e.jsx(fe,{borderRadius:"md",children:e.jsx(be,{placeholder:"Select a status"})}),e.jsx(je,{children:X?e.jsx(H,{item:{label:"Loading statuses...",value:"loading"},children:"Loading statuses..."}):q.items.length>0?q.items.map(i=>e.jsx(H,{item:i,children:i.label},i.value)):e.jsx(H,{item:{label:"No statuses available",value:"none"},children:"No statuses available"})})]})})]}),e.jsxs($,{gap:4,align:"stretch",children:[e.jsxs(w,{gap:4,children:[e.jsx(S,{required:!0,invalid:!!y.buying_price,errorText:y.buying_price?.message,label:"Buying Price (BP)",flex:1,children:e.jsx(_,{value:b,onChange:i=>{const u=T(i.target.value);g(u);const C=k(u);G("buying_price",C,{shouldValidate:!0})},placeholder:"0",type:"text",size:"md",borderRadius:"md"})}),e.jsx(S,{required:!0,invalid:!!y.selling_price,errorText:y.selling_price?.message,label:"Selling Price (SP)",flex:1,children:e.jsx(_,{value:v,onChange:i=>{const u=T(i.target.value);I(u);const C=k(u);G("selling_price",C,{shouldValidate:!0})},placeholder:"0",type:"text",size:"md",borderRadius:"md"})})]}),e.jsxs(w,{gap:4,children:[e.jsx(S,{required:!0,invalid:!!y.current_stock,errorText:y.current_stock?.message,label:"Current Stock",flex:1,children:e.jsx(_,{...A("current_stock",{required:"Current stock is required.",valueAsNumber:!0,min:{value:1,message:"Stock must be at least 1"}}),placeholder:"1",type:"number",size:"md",borderRadius:"md"})}),e.jsx(S,{invalid:!!y.reorder_level,errorText:y.reorder_level?.message,label:e.jsxs(w,{gap:1,children:[e.jsx(p,{children:"Reorder Level"}),e.jsx(kr,{content:"The minimum stock quantity at which you should reorder this product to avoid running out of stock.",positioning:{placement:"top"},children:e.jsx(Pt,{color:{base:"blue.400",_light:"blue.600"},cursor:"help",children:e.jsx(wt,{})})})]}),flex:1,children:e.jsx(_,{...A("reorder_level",{valueAsNumber:!0,min:{value:0,message:"Reorder level cannot be negative"}}),placeholder:"0",type:"number",size:"md",borderRadius:"md"})})]}),e.jsxs(S,{label:"Product Image",helperText:"Upload a JPG or PNG image (max 5MB)",children:[e.jsx("input",{ref:R,type:"file",accept:".jpg,.jpeg,.png,image/jpeg,image/png",onChange:st,style:{display:"none"}}),n?e.jsxs(f,{position:"relative",children:[e.jsx(Tt,{src:n,alt:"Product preview",borderRadius:"md",maxH:"200px",objectFit:"contain",w:"full",bg:{base:"gray.800",_light:"gray.50"}}),e.jsx(kt,{position:"absolute",top:2,right:2,size:"sm",colorScheme:"red",onClick:ot,"aria-label":"Remove image",children:e.jsx(_t,{})})]}):e.jsx(f,{border:"2px dashed",borderColor:{base:"gray.600",_light:"gray.300"},borderRadius:"md",p:6,textAlign:"center",cursor:"pointer",_hover:{borderColor:"teal.400"},onClick:()=>R.current?.click(),children:e.jsxs(re,{direction:"column",align:"center",gap:2,children:[e.jsx(zt,{size:24}),e.jsx(p,{fontSize:"sm",children:"Click to upload image"}),e.jsx(p,{fontSize:"xs",color:{base:"gray.400",_light:"gray.500"},children:"PNG, JPG up to 5MB"})]})})]})]})]})}),e.jsxs(Jt,{mt:6,gap:3,children:[e.jsx(Xt,{asChild:!0,children:e.jsx(de,{variant:"outline",colorScheme:"gray",disabled:M||d,size:"md",children:"Cancel"})}),e.jsx(de,{colorScheme:"teal",type:"submit",disabled:!le||d,loading:M||d,size:"md",children:d?"Uploading...":"Create Product"})]})]}),e.jsx(Zt,{})]})]})};function ue({value:t,onChange:r,children:o,...s}){return e.jsx("select",{value:t,onChange:n=>r(n.target.value),style:{width:"100%",padding:"8px",borderRadius:"6px",borderWidth:"1px",borderStyle:"solid",backgroundColor:"var(--chakra-colors-input-bg)",borderColor:"var(--chakra-colors-input-border)",color:"var(--chakra-colors-text-primary)",fontSize:"14px",cursor:"pointer",...s.style},onFocus:n=>{n.currentTarget.style.borderColor="var(--chakra-colors-teal-500)",n.currentTarget.style.boxShadow="0 0 0 1px var(--chakra-colors-teal-500)"},onBlur:n=>{n.currentTarget.style.borderColor="var(--chakra-colors-input-border)",n.currentTarget.style.boxShadow="none"},...s,children:o})}function rt(t){return t.current_stock===0?"red":t.reorder_level&&t.current_stock!==void 0&&t.current_stock<=t.reorder_level?"orange":"green"}function zr(t){return t.current_stock===0?"Out of Stock":t.reorder_level&&t.current_stock!==void 0&&t.current_stock<=t.reorder_level?"Low Stock":"In Stock"}function Ir({selectedProduct:t,onClose:r}){const o=ke(),{showSuccessToast:s}=ze(),[n,c]=a.useState(t?.current_stock||0),[d,m]=a.useState(0),[b,g]=a.useState(0),[v,I]=a.useState(null),[R,F]=a.useState("");a.useEffect(()=>{t&&(c(t.current_stock||0),m(0),g(0),I(null),F(""))},[t]);const O=n+d,T=O-b,k=v!==null?v-T:null,E=_e({mutationFn:x=>Gt.createStockEntry({requestBody:x}),onSuccess:()=>{s("Stock entry created successfully."),o.invalidateQueries({queryKey:["stock-entries"]}),o.invalidateQueries({queryKey:["products"]}),r()},onError:x=>{te(x)}}),B=()=>{if(!t)return;const x={product_id:t.id,opening_stock:n,added_stock:d,total_stock:O,sales:b,closing_stock:T,physical_count:v||void 0,variance:k||void 0,amount:b*parseFloat(t.selling_price),notes:R||void 0,entry_date:new Date().toISOString()};E.mutate(x)};return t?e.jsxs($,{gap:6,align:"stretch",children:[e.jsxs(f,{children:[e.jsx(p,{fontSize:"md",fontWeight:"semibold",mb:3,children:"Product Details"}),e.jsxs($,{align:"stretch",gap:2,p:4,borderWidth:"1px",borderRadius:"md",bg:{base:"gray.900",_light:"gray.50"},borderColor:{base:"gray.700",_light:"gray.200"},children:[e.jsxs(w,{justify:"space-between",children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Product"}),e.jsx(p,{fontWeight:"semibold",children:t.name})]}),e.jsxs(w,{justify:"space-between",children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Category"}),e.jsx(W,{colorScheme:"blue",size:"sm",children:t.category.name})]}),e.jsxs(w,{justify:"space-between",children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Status"}),e.jsx(W,{colorScheme:"purple",size:"sm",children:t.status.name})]}),e.jsxs(w,{justify:"space-between",children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Selling Price"}),e.jsxs(p,{fontWeight:"bold",color:"teal.400",children:["KES"," ",parseFloat(t.selling_price).toLocaleString()]})]}),e.jsxs(w,{justify:"space-between",children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.400",_light:"gray.600"},children:"Current Stock"}),e.jsxs(W,{colorScheme:rt(t),size:"sm",children:[t.current_stock," units"]})]})]})]}),e.jsx(tr,{}),e.jsxs(f,{children:[e.jsx(p,{fontSize:"md",fontWeight:"semibold",mb:3,children:"Stock Entry"}),e.jsxs($,{gap:4,align:"stretch",children:[e.jsx(S,{label:"Opening Stock",helperText:"Stock at start of day",children:e.jsx(_,{type:"number",value:n,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(S,{label:"Added Stock",helperText:"New deliveries/restocking",children:e.jsx(_,{type:"number",value:d,onChange:x=>m(Number(x.target.value)),min:0})}),e.jsx(S,{label:"Total Available",helperText:"Auto-calculated",children:e.jsx(_,{type:"number",value:O,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(S,{label:"Sales",helperText:"Units sold during shift",children:e.jsx(_,{type:"number",value:b,onChange:x=>g(Number(x.target.value)),min:0,max:O})}),e.jsx(S,{label:"Closing Stock",helperText:"Auto-calculated",children:e.jsx(_,{type:"number",value:T,readOnly:!0,opacity:.7,cursor:"not-allowed"})}),e.jsx(S,{label:"Physical Count",helperText:"Manual count (optional)",children:e.jsx(_,{type:"number",value:v??"",onChange:x=>I(x.target.value?Number(x.target.value):null),min:0,placeholder:"Enter physical count"})}),k!==null&&k!==0&&e.jsxs(f,{p:3,borderRadius:"md",bg:k<0?"red.900":"orange.900",borderWidth:"1px",borderColor:k<0?"red.500":"orange.500",children:[e.jsxs(p,{fontWeight:"bold",color:k<0?"red.300":"orange.300",fontSize:"sm",children:["⚠️ Variance: ",k>0?"+":"",k," units"]}),e.jsx(p,{fontSize:"xs",color:"gray.400",children:k<0?"Stock shortage detected":"Stock surplus detected"})]}),e.jsxs(f,{p:4,bg:{base:"gray.900",_light:"gray.50"},borderRadius:"md",borderWidth:"1px",borderColor:{base:"grey.700",_light:"grey.200"},children:[e.jsx(p,{fontSize:"xs",color:{base:"gray.400",_light:"gray.600"},mb:1,children:"Total Sales Amount"}),e.jsxs(p,{fontSize:"xl",fontWeight:"bold",color:"teal.300",children:["KES"," ",(b*parseFloat(t.selling_price)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx(S,{label:"Notes",helperText:"Additional observations",children:e.jsx(_,{value:R,onChange:x=>F(x.target.value),placeholder:"Optional notes"})}),e.jsx(L,{colorScheme:"teal",size:"lg",onClick:B,loading:E.isPending,disabled:b<0||b>O,w:"full",children:"Submit Stock Entry"})]})]})]}):e.jsxs(f,{textAlign:"center",py:12,color:{base:"gray.500",_light:"gray.600"},children:[e.jsx(Ie,{size:48,style:{margin:"0 auto 16px"}}),e.jsx(p,{fontSize:"lg",children:"No product selected"})]})}function Rr({product:t,onSelect:r}){return e.jsxs(f,{p:4,borderWidth:"1px",borderRadius:"md",bg:{base:"gray.900",_light:"white"},borderColor:{base:"gray.700",_light:"gray.200"},_hover:{borderColor:"teal.500",bg:{base:"gray.800",_light:"gray.50"}},transition:"all 0.2s",cursor:"pointer",onClick:r,children:[e.jsxs(re,{justify:"space-between",align:"start",mb:3,children:[e.jsxs($,{align:"start",gap:1,flex:1,children:[e.jsx(p,{fontWeight:"bold",fontSize:"md",children:t.name}),e.jsxs(w,{gap:2,children:[e.jsx(W,{colorScheme:"blue",size:"sm",children:t.category.name}),e.jsx(W,{colorScheme:"purple",size:"sm",children:t.status.name})]})]}),e.jsx(L,{size:"sm",variant:"ghost",colorScheme:"teal",onClick:o=>{o.stopPropagation(),r()},children:e.jsx(Bt,{})})]}),e.jsxs(ge,{templateColumns:"repeat(3, 1fr)",gap:4,children:[e.jsxs(f,{children:[e.jsx(p,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Stock"}),e.jsx(W,{colorScheme:rt(t),mt:1,children:t.current_stock})]}),e.jsxs(f,{children:[e.jsx(p,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Status"}),e.jsx(p,{fontSize:"xs",fontWeight:"medium",mt:1,children:zr(t)})]}),e.jsxs(f,{textAlign:"right",children:[e.jsx(p,{fontSize:"xs",color:{base:"gray.500",_light:"gray.600"},children:"Price"}),e.jsxs(p,{fontSize:"sm",fontWeight:"bold",color:"teal.400",mt:1,children:["KES ",parseFloat(t.selling_price).toLocaleString()]})]})]})]})}function Wr(){const{user:t}=It(),[r,o]=a.useState(""),[s,n]=a.useState(""),[c,d]=a.useState(null),[m,b]=a.useState(!1),[g,v]=a.useState(1),[I,R]=a.useState(25),[F,O]=a.useState(""),[T,k]=a.useState("");a.useEffect(()=>{const l=setTimeout(()=>{n(r)},300);return()=>clearTimeout(l)},[r]);const{data:E}=Q({queryKey:["categories"],queryFn:()=>K.readCategories()}),{data:B}=Q({queryKey:["statuses"],queryFn:()=>K.readStatuses()}),{data:x,isLoading:X}=Q({queryKey:["products",g,I,s,F,T],queryFn:()=>{const l={skip:(g-1)*I,limit:I};return s.trim()&&(l.name=s.trim()),F&&(l.category_id=F),T&&(l.status_id=T),K.readProducts(l)}}),A=x?.data||[],V=x?.count||0,P=Math.ceil(V/I),G=l=>{d(l),b(!0)},y=()=>{b(!1),setTimeout(()=>d(null),300)},le=()=>{o(""),n(""),O(""),k(""),v(1)};a.useEffect(()=>{v(1)},[s,F,T]);const M=r||F||T;return e.jsxs(Rt,{maxW:"full",minH:"100vh",py:8,children:[e.jsxs($,{gap:6,align:"stretch",children:[e.jsxs(re,{justify:"space-between",align:"start",children:[e.jsxs(f,{children:[e.jsx(er,{size:"lg",mb:2,children:"Product Stock Management"}),e.jsxs(p,{color:{base:"gray.500",_light:"gray.600"},children:["Select a product to record stock entry, deliveries, and sales.",V>0&&` Managing ${V} products total.`]})]}),e.jsxs(w,{gap:3,children:[t?.is_superuser&&e.jsxs(L,{variant:"outline",colorScheme:"blue",onClick:()=>{window.location.href="/stock-entry/bulk-import"},children:[e.jsx(Ft,{})," Bulk Import"]}),e.jsx(_r,{})]})]}),e.jsx(f,{p:4,borderWidth:"1px",borderRadius:"lg",children:e.jsxs($,{gap:4,align:"stretch",children:[e.jsxs(me,{direction:{base:"column",md:"row"},gap:4,children:[e.jsx(f,{flex:1,children:e.jsx(S,{label:"Search Products",children:e.jsxs(f,{position:"relative",children:[e.jsx(_,{placeholder:"Search by product name only...",value:r,onChange:l=>o(l.target.value),size:"md",pr:r&&r!==s?"10":"4"}),r&&r!==s&&e.jsx(f,{position:"absolute",right:"2",top:"50%",transform:"translateY(-50%)",children:e.jsx(p,{fontSize:"xs",color:"gray.500",children:"⏳"})})]})})}),e.jsx(f,{minW:{base:"full",md:"200px"},children:e.jsx(S,{label:"Category",children:e.jsxs(ue,{value:F,onChange:O,children:[e.jsx("option",{value:"",children:"All Categories"}),E?.data.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})})}),e.jsx(f,{minW:{base:"full",md:"200px"},children:e.jsx(S,{label:"Status",children:e.jsxs(ue,{value:T,onChange:k,children:[e.jsx("option",{value:"",children:"All Statuses"}),B?.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})})})]}),e.jsxs(re,{justify:"space-between",align:"center",children:[e.jsxs(w,{gap:2,children:[e.jsxs(p,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:["Showing ",A.length," of ",V," products",P>1&&` (Page ${g} of ${P})`]}),M&&e.jsxs(w,{gap:1,children:[s&&e.jsxs(W,{colorScheme:"teal",size:"sm",children:['Name: "',s,'"']}),F&&E?.data&&e.jsx(W,{colorScheme:"blue",size:"sm",children:E.data.find(l=>l.id===F)?.name}),T&&B&&e.jsx(W,{colorScheme:"purple",size:"sm",children:B.find(l=>l.id===T)?.name})]})]}),M&&e.jsxs(L,{size:"sm",variant:"ghost",onClick:le,children:[e.jsx(At,{})," Clear Filters"]})]})]})}),X?e.jsx(f,{p:8,textAlign:"center",children:e.jsx(p,{color:{base:"gray.500",_light:"gray.600"},children:"Loading products..."})}):A.length===0?e.jsxs(f,{p:8,textAlign:"center",borderWidth:"1px",borderRadius:"lg",children:[e.jsx(Ie,{size:48,style:{margin:"0 auto 16px",opacity:.3}}),e.jsx(p,{color:{base:"gray.500",_light:"gray.600"},fontSize:"lg",mb:2,children:"No products found"}),e.jsx(p,{color:{base:"gray.600",_light:"gray.500"},fontSize:"sm",children:M?"Try adjusting your filters":"Add products to get started"})]}):e.jsx(ge,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)",xl:"repeat(4, 1fr)"},gap:4,children:e.jsx(mr,{each:A,children:l=>e.jsx(Rr,{product:l,onSelect:()=>G(l)},l.id)})}),!X&&P>0&&e.jsx(f,{p:4,borderWidth:"1px",borderRadius:"lg",children:e.jsxs(me,{direction:{base:"column",md:"row"},justify:"space-between",align:"center",gap:4,children:[e.jsxs(w,{gap:2,children:[e.jsx(p,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:"Items per page:"}),e.jsxs(ue,{value:I,onChange:l=>{R(Number(l)),v(1)},style:{maxWidth:"80px",fontSize:"14px",padding:"4px"},children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"})]}),e.jsxs(p,{fontSize:"sm",color:{base:"gray.500",_light:"gray.600"},children:["(",(g-1)*I+1,"-",Math.min(g*I,V)," of ",V,")"]})]}),e.jsxs(w,{gap:2,children:[e.jsx(L,{size:"sm",onClick:()=>v(1),disabled:g===1,variant:"ghost",children:"First"}),e.jsx(L,{size:"sm",onClick:()=>v(l=>Math.max(1,l-1)),disabled:g===1,variant:"ghost",children:e.jsx(Nt,{})}),e.jsx(w,{gap:1,children:Array.from({length:Math.min(5,P)},(l,q)=>{let D;return P<=5||g<=3?D=q+1:g>=P-2?D=P-4+q:D=g-2+q,e.jsx(L,{size:"sm",variant:g===D?"solid":"ghost",colorScheme:g===D?"teal":"gray",onClick:()=>v(D),minW:"8",children:D},D)})}),e.jsx(L,{size:"sm",onClick:()=>v(l=>Math.min(P,l+1)),disabled:g===P,variant:"ghost",children:e.jsx(qt,{})}),e.jsx(L,{size:"sm",onClick:()=>v(P),disabled:g===P,variant:"ghost",children:"Last"})]}),P>10&&e.jsxs(w,{gap:2,children:[e.jsx(p,{fontSize:"sm",color:"gray.500",children:"Go to page:"}),e.jsx(_,{type:"number",min:"1",max:P,value:g,onChange:l=>{const q=Number(l.target.value);q>=1&&q<=P&&v(q)},w:"20",size:"sm"})]})]})})]}),e.jsxs(Dt,{open:m,onOpenChange:l=>!l.open&&y(),size:"md",placement:"end",children:[e.jsx(Ot,{}),e.jsxs(Et,{children:[e.jsxs(Lt,{borderBottomWidth:"1px",children:[e.jsxs(Wt,{children:["Add Stock Entry",c&&` - ${c.name}`]}),e.jsx(Vt,{})]}),e.jsx($t,{children:e.jsx(Ir,{selectedProduct:c,onClose:y})})]})]})]})}export{Wr as component};
