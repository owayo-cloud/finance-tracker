import{_ as Y,D as x,a0 as P,j as e,a1 as S,bn as pe,$ as F,bo as be,aU as K,a2 as ge,a3 as Ce,a4 as fe,bp as ve,bq as ke,a7 as we,aA as ye,aD as Pe,aE as R,aF as Se,aG as Te,X as D,u as O,b as N,aI as A,h as W,c as L,aJ as v,b7 as Re,T as z,e as p,f as k,g as J,q as y,br as U,aN as Ue,bs as _e,bc as qe,bd as Ee,aM as De,be as Ae,C as Ie,a as Ve,bt as Q,E as Fe}from"./index-CxzheAlx.js";import{D as X,a as Z,b as B,d as G,i as ee,f as M,g as H,j as se,c as $,h as Oe,k as Ne,l as Le,e as ze}from"./dialog-CkfW9bA3.js";import{V as re}from"./v-stack-Clf1x48u.js";import{B as Be,T as ae,a as ne,b as _,c as g,d as te,e as C,S as T,P as Ge,f as Me,g as He,h as $e}from"./pagination-oGRgrJ6W.js";import{H as Qe}from"./index-D7ZSCJA-.js";import{B as Ye}from"./badge-DapnaDzq.js";const[oe,I]=Y({name:"CheckboxContext",hookName:"useCheckboxContext",providerName:"<CheckboxProvider />"}),ie=x.forwardRef((n,s)=>{const r=I(),i=P(r.getControlProps(),n);return e.jsx(S.div,{...i,ref:s})});ie.displayName="CheckboxControl";function Ke(n){const{value:s,onChange:r,defaultValue:i}=n,[t,c]=x.useState(i),l=s!==void 0,d=l?s:t,m=x.useCallback(u=>(l||c(u),r?.(u)),[l,r]);return[d,m]}function We(n={}){const{defaultValue:s,value:r,onValueChange:i,disabled:t,readOnly:c,name:l,invalid:d}=n,m=!(t||c),u=pe(i,{sync:!0}),[o,h]=Ke({value:r,defaultValue:s||[],onChange:u}),b=j=>o.some(V=>String(V)===String(j)),w=j=>{b(j)?f(j):a(j)},a=j=>{m&&(b(j)||h(o.concat(j)))},f=j=>{m&&h(o.filter(V=>String(V)!==String(j)))};return{isChecked:b,value:o,name:l,disabled:!!t,readOnly:!!c,invalid:!!d,setValue:h,addValue:a,toggleValue:w,getItemProps:j=>({checked:j.value!=null?b(j.value):void 0,onCheckedChange(){j.value!=null&&w(j.value)},name:l,disabled:t,readOnly:c,invalid:d})}}const[Je,Xe]=Y({name:"CheckboxGroupContext",hookName:"useCheckboxGroupContext",providerName:"<CheckboxGroupProvider />",strict:!1}),le=x.forwardRef((n,s)=>{const[r,i]=F()(n,["defaultValue","value","onValueChange","disabled","invalid","readOnly","name"]),t=We(r);return e.jsx(Je,{value:t,children:e.jsx(S.div,{ref:s,role:"group",...i,...be.build().group.attrs})})});le.displayName="CheckboxGroup";const ce=x.forwardRef((n,s)=>{const r=I(),i=P(r.getHiddenInputProps(),n),t=K();return e.jsx(S.input,{"aria-describedby":t?.ariaDescribedby,...i,ref:s})});ce.displayName="CheckboxHiddenInput";const de=x.forwardRef((n,s)=>{const r=I(),i=P(r.getLabelProps(),n);return e.jsx(S.span,{...i,ref:s})});de.displayName="CheckboxLabel";const Ze=(n={})=>{const s=Xe(),r=K(),i=x.useMemo(()=>P(n,s?.getItemProps({value:n.value})??{}),[n,s]),t=x.useId(),{getRootNode:c}=ge(),{dir:l}=Ce(),d={id:t,ids:{label:r?.ids.label,hiddenInput:r?.ids.control},dir:l,disabled:r?.disabled,readOnly:r?.readOnly,invalid:r?.invalid,required:r?.required,getRootNode:c,...i},m=fe(ve,d);return ke(m,we)},ue=x.forwardRef((n,s)=>{const[r,i]=F()(n,["checked","defaultChecked","disabled","form","id","ids","invalid","name","onCheckedChange","readOnly","required","value"]),t=Ze(r),c=P(t.getRootProps(),i);return e.jsx(oe,{value:t,children:e.jsx(S.label,{...c,ref:s})})});ue.displayName="CheckboxRoot";const he=x.forwardRef((n,s)=>{const[{value:r},i]=F()(n,["value"]),t=P(r.getRootProps(),i);return e.jsx(oe,{value:r,children:e.jsx(S.label,{...t,ref:s})})});he.displayName="CheckboxRootProvider";const es=x.forwardRef(function(s,r){const i=ye({key:"checkmark",recipe:s.recipe}),[t,c]=i.splitVariantProps(s),{checked:l,indeterminate:d,disabled:m,unstyled:u,children:o,...h}=c,b=u?Pe:i(t);return e.jsx(R.svg,{ref:r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3px",strokeLinecap:"round",strokeLinejoin:"round","data-state":d?"indeterminate":l?"checked":"unchecked","data-disabled":Se(m),css:[b,s.css],...h,children:d?e.jsx("path",{d:"M5 12h14"}):l?e.jsx("polyline",{points:"20 6 9 17 4 12"}):null})}),{withProvider:xe,withContext:me,useStyles:ss}=Te({key:"checkbox"});xe(he,"root",{forwardAsChild:!0});const rs=xe(ue,"root",{forwardAsChild:!0}),as=me(de,"label",{forwardAsChild:!0}),je=x.forwardRef(function(s,r){const{checked:i,indeterminate:t,...c}=s,l=I(),d=ss();return i&&l.checked?e.jsx(R.svg,{ref:r,asChild:!0,...c,css:[d.indicator,s.css],children:i}):t&&l.indeterminate?e.jsx(R.svg,{ref:r,asChild:!0,...c,css:[d.indicator,s.css],children:t}):e.jsx(es,{ref:r,checked:l.checked,indeterminate:l.indeterminate,disabled:l.disabled,unstyled:!0,...c,css:[d.indicator,s.css]})}),ns=me(ie,"control",{forwardAsChild:!0,defaultProps:{children:e.jsx(je,{})}});R(le,{base:{display:"flex",flexDirection:"column",gap:"1.5"}},{forwardAsChild:!0});const ts=ce,q=x.forwardRef(function(s,r){const{icon:i,children:t,inputProps:c,rootRef:l,...d}=s;return e.jsxs(rs,{ref:l,...d,children:[e.jsx(ts,{ref:r,...c}),e.jsx(ns,{children:i||e.jsx(je,{})}),t!=null&&e.jsx(as,{children:t})]})}),os=()=>{const[n,s]=x.useState(!1),r=D(),{showSuccessToast:i}=L(),{control:t,register:c,handleSubmit:l,reset:d,getValues:m,formState:{errors:u,isValid:o,isSubmitting:h}}=O({mode:"onBlur",criteriaMode:"all",defaultValues:{email:"",full_name:"",password:"",confirm_password:"",is_superuser:!1,is_active:!1}}),b=N({mutationFn:a=>A.createUser({requestBody:a}),onSuccess:()=>{i("User created successfully."),d(),s(!1)},onError:a=>{W(a)},onSettled:()=>{r.invalidateQueries({queryKey:["users"]})}}),w=a=>{b.mutate(a)};return e.jsxs(X,{size:{base:"xs",md:"md"},placement:"center",open:n,onOpenChange:({open:a})=>s(a),children:[e.jsx(Z,{asChild:!0,children:e.jsxs(v,{value:"add-user",my:4,children:[e.jsx(Re,{fontSize:"16px"}),"Add User"]})}),e.jsxs(B,{children:[e.jsxs("form",{onSubmit:l(w),children:[e.jsx(G,{children:e.jsx(ee,{children:"Add User"})}),e.jsxs(M,{children:[e.jsx(z,{mb:4,children:"Fill in the form below to add a new user to the system."}),e.jsxs(re,{gap:4,children:[e.jsx(p,{required:!0,invalid:!!u.email,errorText:u.email?.message,label:"Email",children:e.jsx(k,{...c("email",{required:"Email is required",pattern:J}),placeholder:"Email",type:"email"})}),e.jsx(p,{invalid:!!u.full_name,errorText:u.full_name?.message,label:"Full Name",children:e.jsx(k,{...c("full_name"),placeholder:"Full name",type:"text"})}),e.jsx(p,{required:!0,invalid:!!u.password,errorText:u.password?.message,label:"Set Password",children:e.jsx(k,{...c("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}}),placeholder:"Password",type:"password"})}),e.jsx(p,{required:!0,invalid:!!u.confirm_password,errorText:u.confirm_password?.message,label:"Confirm Password",children:e.jsx(k,{...c("confirm_password",{required:"Please confirm your password",validate:a=>a===m().password||"The passwords do not match"}),placeholder:"Password",type:"password"})})]}),e.jsxs(y,{mt:4,direction:"column",gap:4,children:[e.jsx(U,{control:t,name:"is_superuser",render:({field:a})=>e.jsx(p,{disabled:a.disabled,colorPalette:"teal",children:e.jsx(q,{checked:a.value,onCheckedChange:({checked:f})=>a.onChange(f),children:"Is superuser?"})})}),e.jsx(U,{control:t,name:"is_active",render:({field:a})=>e.jsx(p,{disabled:a.disabled,colorPalette:"teal",children:e.jsx(q,{checked:a.value,onCheckedChange:({checked:f})=>a.onChange(f),children:"Is active?"})})})]})]}),e.jsxs(H,{gap:2,children:[e.jsx(se,{asChild:!0,children:e.jsx(v,{variant:"subtle",colorPalette:"gray",disabled:h,children:"Cancel"})}),e.jsx(v,{variant:"solid",type:"submit",disabled:!o,loading:h,children:"Save"})]})]}),e.jsx($,{})]})]})},is=({id:n})=>{const[s,r]=x.useState(!1),i=D(),{showSuccessToast:t,showErrorToast:c}=L(),{handleSubmit:l,formState:{isSubmitting:d}}=O(),u=N({mutationFn:async h=>{await A.deleteUser({userId:h})},onSuccess:()=>{t("The user was deleted successfully"),r(!1)},onError:()=>{c("An error occurred while deleting the user")},onSettled:()=>{i.invalidateQueries()}}),o=async()=>{u.mutate(n)};return e.jsxs(X,{size:{base:"xs",md:"md"},placement:"center",role:"alertdialog",open:s,onOpenChange:({open:h})=>r(h),children:[e.jsx(Z,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"sm",colorPalette:"red",children:[e.jsx(Ue,{fontSize:"16px"}),"Delete User"]})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:l(o),children:[e.jsx(G,{children:e.jsx(ee,{children:"Delete User"})}),e.jsx(M,{children:e.jsxs(z,{mb:4,children:["All items associated with this user will also be"," ",e.jsx("strong",{children:"permanently deleted."})," Are you sure? You will not be able to undo this action."]})}),e.jsxs(H,{gap:2,children:[e.jsx(Oe,{asChild:!0,children:e.jsx(v,{variant:"subtle",colorPalette:"gray",disabled:d,children:"Cancel"})}),e.jsx(v,{variant:"solid",colorPalette:"red",type:"submit",loading:d,children:"Delete"})]}),e.jsx($,{})]})})]})},ls=({user:n})=>{const[s,r]=x.useState(!1),i=D(),{showSuccessToast:t}=L(),{control:c,register:l,handleSubmit:d,reset:m,getValues:u,formState:{errors:o,isSubmitting:h}}=O({mode:"onBlur",criteriaMode:"all",defaultValues:n}),b=N({mutationFn:a=>A.updateUser({userId:n.id,requestBody:a}),onSuccess:()=>{t("User updated successfully."),m(),r(!1)},onError:a=>{W(a)},onSettled:()=>{i.invalidateQueries({queryKey:["users"]})}}),w=async a=>{a.password===""&&(a.password=void 0),b.mutate(a)};return e.jsxs(Ne,{size:{base:"xs",md:"md"},placement:"center",open:s,onOpenChange:({open:a})=>r(a),children:[e.jsx(Le,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"sm",children:[e.jsx(_e,{fontSize:"16px"}),"Edit User"]})}),e.jsx(B,{children:e.jsxs("form",{onSubmit:d(w),children:[e.jsx(G,{children:e.jsx(ze,{children:"Edit User"})}),e.jsxs(M,{children:[e.jsx(z,{mb:4,children:"Update the user details below."}),e.jsxs(re,{gap:4,children:[e.jsx(p,{required:!0,invalid:!!o.email,errorText:o.email?.message,label:"Email",children:e.jsx(k,{...l("email",{required:"Email is required",pattern:J}),placeholder:"Email",type:"email"})}),e.jsx(p,{invalid:!!o.full_name,errorText:o.full_name?.message,label:"Full Name",children:e.jsx(k,{...l("full_name"),placeholder:"Full name",type:"text"})}),e.jsx(p,{invalid:!!o.password,errorText:o.password?.message,label:"Set Password",children:e.jsx(k,{...l("password",{minLength:{value:8,message:"Password must be at least 8 characters"}}),placeholder:"Password",type:"password"})}),e.jsx(p,{invalid:!!o.confirm_password,errorText:o.confirm_password?.message,label:"Confirm Password",children:e.jsx(k,{...l("confirm_password",{validate:a=>a===u().password||"The passwords do not match"}),placeholder:"Password",type:"password"})})]}),e.jsxs(y,{mt:4,direction:"column",gap:4,children:[e.jsx(U,{control:c,name:"is_superuser",render:({field:a})=>e.jsx(p,{disabled:a.disabled,colorPalette:"teal",children:e.jsx(q,{checked:a.value,onCheckedChange:({checked:f})=>a.onChange(f),children:"Is superuser?"})})}),e.jsx(U,{control:c,name:"is_active",render:({field:a})=>e.jsx(p,{disabled:a.disabled,colorPalette:"teal",children:e.jsx(q,{checked:a.value,onCheckedChange:({checked:f})=>a.onChange(f),children:"Is active?"})})})]})]}),e.jsxs(H,{gap:2,children:[e.jsx(se,{asChild:!0,children:e.jsx(v,{variant:"subtle",colorPalette:"gray",disabled:h,children:"Cancel"})}),e.jsx(v,{variant:"solid",type:"submit",loading:h,children:"Save"})]}),e.jsx($,{})]})})]})},cs=({user:n,disabled:s})=>e.jsxs(qe,{children:[e.jsx(Ee,{asChild:!0,children:e.jsx(De,{variant:"ghost",color:"inherit",disabled:s,children:e.jsx(Be,{})})}),e.jsxs(Ae,{children:[e.jsx(ls,{user:n}),e.jsx(is,{id:n.id})]})]}),ds=()=>e.jsxs(ae,{size:{base:"sm",md:"md"},children:[e.jsx(ne,{children:e.jsxs(_,{children:[e.jsx(g,{w:"sm",children:"Full name"}),e.jsx(g,{w:"sm",children:"Email"}),e.jsx(g,{w:"sm",children:"Role"}),e.jsx(g,{w:"sm",children:"Status"}),e.jsx(g,{w:"sm",children:"Actions"})]})}),e.jsx(te,{children:[...Array(5)].map((n,s)=>e.jsxs(_,{children:[e.jsx(C,{children:e.jsx(T,{noOfLines:1})}),e.jsx(C,{children:e.jsx(T,{noOfLines:1})}),e.jsx(C,{children:e.jsx(T,{noOfLines:1})}),e.jsx(C,{children:e.jsx(T,{noOfLines:1})}),e.jsx(C,{children:e.jsx(T,{noOfLines:1})})]},s))})]}),E=5;function us({page:n}){return{queryFn:()=>A.readUsers({skip:(n-1)*E,limit:E}),queryKey:["users",{page:n}]}}function hs(){const s=D().getQueryData(["currentUser"]),r=Ve({from:Q.fullPath}),{page:i}=Q.useSearch(),{data:t,isLoading:c,isPlaceholderData:l}=Fe({...us({page:i}),placeholderData:o=>o}),d=o=>{r({to:"/admin",search:h=>({...h,page:o})})},m=t?.data.slice(0,E)??[],u=t?.count??0;return c?e.jsx(ds,{}):e.jsxs(e.Fragment,{children:[e.jsxs(ae,{size:{base:"sm",md:"md"},variant:"outline",children:[e.jsx(ne,{children:e.jsxs(_,{children:[e.jsx(g,{w:"sm",children:"Full name"}),e.jsx(g,{w:"sm",children:"Email"}),e.jsx(g,{w:"sm",children:"Role"}),e.jsx(g,{w:"sm",children:"Status"}),e.jsx(g,{w:"sm",children:"Actions"})]})}),e.jsx(te,{children:m?.map(o=>e.jsxs(_,{opacity:l?.5:1,children:[e.jsxs(C,{color:o.full_name?void 0:"gray.500",children:[o.full_name||"N/A",s?.id===o.id&&e.jsx(Ye,{ml:"1",colorScheme:"teal",children:"You"})]}),e.jsx(C,{truncate:!0,maxW:"sm",children:o.email}),e.jsx(C,{children:o.is_superuser?"Superuser":"User"}),e.jsx(C,{children:o.is_active?"Active":"Inactive"}),e.jsx(C,{children:e.jsx(cs,{user:o,disabled:s?.id===o.id})})]},o.id))})]}),e.jsx(y,{justifyContent:"flex-end",mt:4,children:e.jsx(Ge,{count:u,pageSize:E,onPageChange:({page:o})=>d(o),children:e.jsxs(y,{children:[e.jsx(Me,{}),e.jsx(He,{}),e.jsx($e,{})]})})})]})}function fs(){return e.jsx(Ie,{maxW:"full",minH:"100vh",children:e.jsxs(y,{direction:"column",gap:6,pt:12,pb:8,children:[e.jsxs(y,{justify:"space-between",align:"center",children:[e.jsx(Qe,{size:"lg",children:"Users Management"}),e.jsx(os,{})]}),e.jsx(hs,{})]})})}export{fs as component};
